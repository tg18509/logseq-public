<!DOCTYPE html>
<head><meta charset="utf-8"></meta>
 <meta content="minimum-scale=1, initial-scale=1, width=device-width, shrink-to-fit=no" name="viewport"></meta>
 <link type="text/css" href="static/css/tabler-icons.min.css" rel="stylesheet"></link>
 <link type="text/css" href="static/css/style.css" rel="stylesheet"></link>
 <link type="text/css" href="static/css/custom.css" rel="stylesheet"></link>
 <link type="text/css" href="static/css/export.css" rel="stylesheet"></link>
 <link href="static/img/logo.png" type="image/png" rel="shortcut icon"></link>
 <link href="static/img/logo.png" sizes="192x192" rel="shortcut icon"></link>
 <link href="static/img/logo.png" rel="apple-touch-icon"></link>
 <meta name="apple-mobile-web-app-title"></meta>
 <meta name="apple-mobile-web-app-capable" content="yes"></meta>
 <meta name="apple-touch-fullscreen" content="yes"></meta>
 <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"></meta>
 <meta name="mobile-web-app-capable" content="yes"></meta>
 <meta property="og:title"></meta>
 <meta content="site" property="og:type"></meta>
  <meta content="static/img/logo.png" property="og:image"></meta>
 <meta property="og:description"></meta>
 <title></title>
 <meta property="og:site_name"></meta>
 <meta></meta>
</head>
 <body><div id="root"></div>
 <script>window.logseq_db="[logseq____&quot;~#datascript/DBlogseq____&quot;,[logseq____&quot;^ logseq____&quot;,logseq____&quot;~:schemalogseq____&quot;,[logseq____&quot;^ logseq____&quot;,logseq____&quot;~:ast/versionlogseq____&quot;,[logseq____&quot;^ logseq____&quot;],logseq____&quot;~:file/contentlogseq____&quot;,[logseq____&quot;^ logseq____&quot;],logseq____&quot;~:block/properties-text-valueslogseq____&quot;,[logseq____&quot;^ logseq____&quot;],logseq____&quot;~:block/aliaslogseq____&quot;,[logseq____&quot;^ logseq____&quot;,logseq____&quot;~:db/valueTypelogseq____&quot;,logseq____&quot;~:db.type/reflogseq____&quot;,logseq____&quot;~:db/cardinalitylogseq____&quot;,logseq____&quot;~:db.cardinality/manylogseq____&quot;],logseq____&quot;~:block/pre-block?logseq____&quot;,[logseq____&quot;^ logseq____&quot;],logseq____&quot;~:block/uuidlogseq____&quot;,[logseq____&quot;^ logseq____&quot;,logseq____&quot;~:db/uniquelogseq____&quot;,logseq____&quot;~:db.unique/identitylogseq____&quot;],logseq____&quot;~:block/prioritylogseq____&quot;,[logseq____&quot;^ logseq____&quot;],logseq____&quot;~:block/propertieslogseq____&quot;,[logseq____&quot;^ logseq____&quot;],logseq____&quot;~:block/journal?logseq____&quot;,[logseq____&quot;^ logseq____&quot;],logseq____&quot;~:block/namespacelogseq____&quot;,[logseq____&quot;^ logseq____&quot;,logseq____&quot;^6logseq____&quot;,logseq____&quot;^7logseq____&quot;],logseq____&quot;~:block/updated-atlogseq____&quot;,[logseq____&quot;^ logseq____&quot;],logseq____&quot;~:block/repeated?logseq____&quot;,[logseq____&quot;^ logseq____&quot;],logseq____&quot;~:db/typelogseq____&quot;,[logseq____&quot;^ logseq____&quot;],logseq____&quot;~:file/handlelogseq____&quot;,[logseq____&quot;^ logseq____&quot;],logseq____&quot;~:block/leftlogseq____&quot;,[logseq____&quot;^ logseq____&quot;,logseq____&quot;^6logseq____&quot;,logseq____&quot;^7logseq____&quot;,logseq____&quot;~:db/indexlogseq____&quot;,true],logseq____&quot;~:block/refslogseq____&quot;,[logseq____&quot;^ logseq____&quot;,logseq____&quot;^6logseq____&quot;,logseq____&quot;^7logseq____&quot;,logseq____&quot;^8logseq____&quot;,logseq____&quot;^9logseq____&quot;],logseq____&quot;~:block/scheduledlogseq____&quot;,[logseq____&quot;^ logseq____&quot;],logseq____&quot;~:block/properties-orderlogseq____&quot;,[logseq____&quot;^ logseq____&quot;],logseq____&quot;~:block/created-atlogseq____&quot;,[logseq____&quot;^ logseq____&quot;],logseq____&quot;~:block/deadlinelogseq____&quot;,[logseq____&quot;^ logseq____&quot;],logseq____&quot;~:block/collapsed?logseq____&quot;,[logseq____&quot;^ logseq____&quot;,logseq____&quot;^Glogseq____&quot;,true],logseq____&quot;~:block/journal-daylogseq____&quot;,[logseq____&quot;^ logseq____&quot;],logseq____&quot;~:block/formatlogseq____&quot;,[logseq____&quot;^ logseq____&quot;],logseq____&quot;~:block/tagslogseq____&quot;,[logseq____&quot;^ logseq____&quot;,logseq____&quot;^6logseq____&quot;,logseq____&quot;^7logseq____&quot;,logseq____&quot;^8logseq____&quot;,logseq____&quot;^9logseq____&quot;],logseq____&quot;~:block/contentlogseq____&quot;,[logseq____&quot;^ logseq____&quot;],logseq____&quot;~:recent/pageslogseq____&quot;,[logseq____&quot;^ logseq____&quot;],logseq____&quot;~:block/macroslogseq____&quot;,[logseq____&quot;^ logseq____&quot;,logseq____&quot;^6logseq____&quot;,logseq____&quot;^7logseq____&quot;,logseq____&quot;^8logseq____&quot;,logseq____&quot;^9logseq____&quot;],logseq____&quot;~:db/identlogseq____&quot;,[logseq____&quot;^ logseq____&quot;,logseq____&quot;^logseq____&lt;logseq____&quot;,logseq____&quot;^=logseq____&quot;],logseq____&quot;~:block/path-refslogseq____&quot;,[logseq____&quot;^ logseq____&quot;,logseq____&quot;^6logseq____&quot;,logseq____&quot;^7logseq____&quot;,logseq____&quot;^8logseq____&quot;,logseq____&quot;^9logseq____&quot;],logseq____&quot;~:block/parentlogseq____&quot;,[logseq____&quot;^ logseq____&quot;,logseq____&quot;^6logseq____&quot;,logseq____&quot;^7logseq____&quot;,logseq____&quot;^Glogseq____&quot;,true],logseq____&quot;~:block/typelogseq____&quot;,[logseq____&quot;^ logseq____&quot;],logseq____&quot;~:block/pagelogseq____&quot;,[logseq____&quot;^ logseq____&quot;,logseq____&quot;^6logseq____&quot;,logseq____&quot;^7logseq____&quot;,logseq____&quot;^Glogseq____&quot;,true],logseq____&quot;~:block/namelogseq____&quot;,[logseq____&quot;^ logseq____&quot;,logseq____&quot;^logseq____&lt;logseq____&quot;,logseq____&quot;^=logseq____&quot;],logseq____&quot;~:file/pathlogseq____&quot;,[logseq____&quot;^ logseq____&quot;,logseq____&quot;^logseq____&lt;logseq____&quot;,logseq____&quot;^=logseq____&quot;],logseq____&quot;~:block/filelogseq____&quot;,[logseq____&quot;^ logseq____&quot;,logseq____&quot;^6logseq____&quot;,logseq____&quot;^7logseq____&quot;],logseq____&quot;~:block/markerlogseq____&quot;,[logseq____&quot;^ logseq____&quot;],logseq____&quot;~:block/original-namelogseq____&quot;,[logseq____&quot;^ logseq____&quot;,logseq____&quot;^logseq____&lt;logseq____&quot;,logseq____&quot;^=logseq____&quot;],logseq____&quot;~:schema/versionlogseq____&quot;,[logseq____&quot;^ logseq____&quot;]],logseq____&quot;~:datomslogseq____&quot;,[logseq____&quot;~#listlogseq____&quot;,[[logseq____&quot;~#datascript/Datomlogseq____&quot;,[1,logseq____&quot;^12logseq____&quot;,2,536870913]],[logseq____&quot;^15logseq____&quot;,[2,logseq____&quot;^@logseq____&quot;,false,536870914]],[logseq____&quot;^15logseq____&quot;,[2,logseq____&quot;^Ylogseq____&quot;,logseq____&quot;cardlogseq____&quot;,536870913]],[logseq____&quot;^15logseq____&quot;,[2,logseq____&quot;^11logseq____&quot;,logseq____&quot;cardlogseq____&quot;,536870913]],[logseq____&quot;^15logseq____&quot;,[2,logseq____&quot;^;logseq____&quot;,logseq____&quot;~uc472d06d-f208-4bfb-95f5-a7d002ee7594logseq____&quot;,536870914]],[logseq____&quot;^15logseq____&quot;,[3,logseq____&quot;^@logseq____&quot;,false,536870914]],[logseq____&quot;^15logseq____&quot;,[3,logseq____&quot;^Ylogseq____&quot;,logseq____&quot;canceledlogseq____&quot;,536870914]],[logseq____&quot;^15logseq____&quot;,[3,logseq____&quot;^11logseq____&quot;,logseq____&quot;CANCELEDlogseq____&quot;,536870914]],[logseq____&quot;^15logseq____&quot;,[3,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u49f03871-56e0-498d-901e-da833dc53ea0logseq____&quot;,536870914]],[logseq____&quot;^15logseq____&quot;,[4,logseq____&quot;^@logseq____&quot;,false,536870914]],[logseq____&quot;^15logseq____&quot;,[4,logseq____&quot;^Ylogseq____&quot;,logseq____&quot;todologseq____&quot;,536870914]],[logseq____&quot;^15logseq____&quot;,[4,logseq____&quot;^11logseq____&quot;,logseq____&quot;TODOlogseq____&quot;,536870914]],[logseq____&quot;^15logseq____&quot;,[4,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u6c1bbb02-6bc9-47f2-a3c1-79eaf22bf9c3logseq____&quot;,536870914]],[logseq____&quot;^15logseq____&quot;,[5,logseq____&quot;^@logseq____&quot;,false,536870914]],[logseq____&quot;^15logseq____&quot;,[5,logseq____&quot;^Ylogseq____&quot;,logseq____&quot;nowlogseq____&quot;,536870914]],[logseq____&quot;^15logseq____&quot;,[5,logseq____&quot;^11logseq____&quot;,logseq____&quot;NOWlogseq____&quot;,536870914]],[logseq____&quot;^15logseq____&quot;,[5,logseq____&quot;^;logseq____&quot;,logseq____&quot;~ud7a98e05-3879-410f-bf29-395670a526e5logseq____&quot;,536870914]],[logseq____&quot;^15logseq____&quot;,[6,logseq____&quot;^@logseq____&quot;,false,536870914]],[logseq____&quot;^15logseq____&quot;,[6,logseq____&quot;^Ylogseq____&quot;,logseq____&quot;laterlogseq____&quot;,536870914]],[logseq____&quot;^15logseq____&quot;,[6,logseq____&quot;^11logseq____&quot;,logseq____&quot;LATERlogseq____&quot;,536870914]],[logseq____&quot;^15logseq____&quot;,[6,logseq____&quot;^;logseq____&quot;,logseq____&quot;~ud5276606-570d-493f-b3f5-accab2816405logseq____&quot;,536870914]],[logseq____&quot;^15logseq____&quot;,[7,logseq____&quot;^@logseq____&quot;,false,536870914]],[logseq____&quot;^15logseq____&quot;,[7,logseq____&quot;^Ylogseq____&quot;,logseq____&quot;donelogseq____&quot;,536870914]],[logseq____&quot;^15logseq____&quot;,[7,logseq____&quot;^11logseq____&quot;,logseq____&quot;DONElogseq____&quot;,536870914]],[logseq____&quot;^15logseq____&quot;,[7,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u8b56f5db-b265-47d8-b232-94e0bc88db7dlogseq____&quot;,536870914]],[logseq____&quot;^15logseq____&quot;,[8,logseq____&quot;^@logseq____&quot;,false,536870914]],[logseq____&quot;^15logseq____&quot;,[8,logseq____&quot;^Ylogseq____&quot;,logseq____&quot;doinglogseq____&quot;,536870914]],[logseq____&quot;^15logseq____&quot;,[8,logseq____&quot;^11logseq____&quot;,logseq____&quot;DOINGlogseq____&quot;,536870914]],[logseq____&quot;^15logseq____&quot;,[8,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u2d15f6f7-cc94-4a4f-b2fb-053830a32466logseq____&quot;,536870914]],[logseq____&quot;^15logseq____&quot;,[9,logseq____&quot;^@logseq____&quot;,false,536870914]],[logseq____&quot;^15logseq____&quot;,[9,logseq____&quot;^Ylogseq____&quot;,logseq____&quot;in-progresslogseq____&quot;,536870914]],[logseq____&quot;^15logseq____&quot;,[9,logseq____&quot;^11logseq____&quot;,logseq____&quot;IN-PROGRESSlogseq____&quot;,536870914]],[logseq____&quot;^15logseq____&quot;,[9,logseq____&quot;^;logseq____&quot;,logseq____&quot;~ud1b9cc00-a3f8-4822-8684-80b893634c45logseq____&quot;,536870914]],[logseq____&quot;^15logseq____&quot;,[10,logseq____&quot;^@logseq____&quot;,false,536870914]],[logseq____&quot;^15logseq____&quot;,[10,logseq____&quot;^Ylogseq____&quot;,logseq____&quot;clogseq____&quot;,536870914]],[logseq____&quot;^15logseq____&quot;,[10,logseq____&quot;^11logseq____&quot;,logseq____&quot;Clogseq____&quot;,536870914]],[logseq____&quot;^15logseq____&quot;,[10,logseq____&quot;^;logseq____&quot;,logseq____&quot;~uc64f09cd-7f63-4264-883e-919b19460f93logseq____&quot;,536870914]],[logseq____&quot;^15logseq____&quot;,[11,logseq____&quot;^@logseq____&quot;,false,536870914]],[logseq____&quot;^15logseq____&quot;,[11,logseq____&quot;^Ylogseq____&quot;,logseq____&quot;blogseq____&quot;,536870914]],[logseq____&quot;^15logseq____&quot;,[11,logseq____&quot;^11logseq____&quot;,logseq____&quot;Blogseq____&quot;,536870914]],[logseq____&quot;^15logseq____&quot;,[11,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u8ad77f06-d73f-4980-b244-181013e9d4eelogseq____&quot;,536870914]],[logseq____&quot;^15logseq____&quot;,[12,logseq____&quot;^@logseq____&quot;,false,536870914]],[logseq____&quot;^15logseq____&quot;,[12,logseq____&quot;^Ylogseq____&quot;,logseq____&quot;contentslogseq____&quot;,536870914]],[logseq____&quot;^15logseq____&quot;,[12,logseq____&quot;^11logseq____&quot;,logseq____&quot;contentslogseq____&quot;,536870918]],[logseq____&quot;^15logseq____&quot;,[12,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-cfe5-4c94-bd57-2d024df0b998logseq____&quot;,536870918]],[logseq____&quot;^15logseq____&quot;,[13,logseq____&quot;^@logseq____&quot;,false,536870914]],[logseq____&quot;^15logseq____&quot;,[13,logseq____&quot;^Ylogseq____&quot;,logseq____&quot;waitinglogseq____&quot;,536870914]],[logseq____&quot;^15logseq____&quot;,[13,logseq____&quot;^11logseq____&quot;,logseq____&quot;WAITINGlogseq____&quot;,536870914]],[logseq____&quot;^15logseq____&quot;,[13,logseq____&quot;^;logseq____&quot;,logseq____&quot;~ua58d4e89-8907-4467-a8af-df202777eb37logseq____&quot;,536870914]],[logseq____&quot;^15logseq____&quot;,[14,logseq____&quot;^@logseq____&quot;,false,536870914]],[logseq____&quot;^15logseq____&quot;,[14,logseq____&quot;^Ylogseq____&quot;,logseq____&quot;favoriteslogseq____&quot;,536870914]],[logseq____&quot;^15logseq____&quot;,[14,logseq____&quot;^11logseq____&quot;,logseq____&quot;Favoriteslogseq____&quot;,536870914]],[logseq____&quot;^15logseq____&quot;,[14,logseq____&quot;^;logseq____&quot;,logseq____&quot;~uda9488c4-1d50-4f10-b9fd-f8602dc65319logseq____&quot;,536870914]],[logseq____&quot;^15logseq____&quot;,[15,logseq____&quot;^@logseq____&quot;,false,536870914]],[logseq____&quot;^15logseq____&quot;,[15,logseq____&quot;^Ylogseq____&quot;,logseq____&quot;alogseq____&quot;,536870914]],[logseq____&quot;^15logseq____&quot;,[15,logseq____&quot;^11logseq____&quot;,logseq____&quot;Alogseq____&quot;,536870914]],[logseq____&quot;^15logseq____&quot;,[15,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u27481447-e9d4-4ade-97a3-7f467b127424logseq____&quot;,536870914]],[logseq____&quot;^15logseq____&quot;,[16,logseq____&quot;^@logseq____&quot;,false,536870914]],[logseq____&quot;^15logseq____&quot;,[16,logseq____&quot;^Ylogseq____&quot;,logseq____&quot;cancelledlogseq____&quot;,536870914]],[logseq____&quot;^15logseq____&quot;,[16,logseq____&quot;^11logseq____&quot;,logseq____&quot;CANCELLEDlogseq____&quot;,536870914]],[logseq____&quot;^15logseq____&quot;,[16,logseq____&quot;^;logseq____&quot;,logseq____&quot;~uce382417-06f4-43cd-8110-f1177bc71b9flogseq____&quot;,536870914]],[logseq____&quot;^15logseq____&quot;,[17,logseq____&quot;^@logseq____&quot;,false,536870914]],[logseq____&quot;^15logseq____&quot;,[17,logseq____&quot;^Ylogseq____&quot;,logseq____&quot;waitlogseq____&quot;,536870914]],[logseq____&quot;^15logseq____&quot;,[17,logseq____&quot;^11logseq____&quot;,logseq____&quot;WAITlogseq____&quot;,536870914]],[logseq____&quot;^15logseq____&quot;,[17,logseq____&quot;^;logseq____&quot;,logseq____&quot;~ub73ab18e-106f-410c-a368-6e5488ef57c5logseq____&quot;,536870914]],[logseq____&quot;^15logseq____&quot;,[19,logseq____&quot;^Klogseq____&quot;,1725436529486,536870915]],[logseq____&quot;^15logseq____&quot;,[19,logseq____&quot;^Nlogseq____&quot;,20240904,536870915]],[logseq____&quot;^15logseq____&quot;,[19,logseq____&quot;^@logseq____&quot;,true,536870915]],[logseq____&quot;^15logseq____&quot;,[19,logseq____&quot;^Ylogseq____&quot;,logseq____&quot;sep 4th, 2024logseq____&quot;,536870915]],[logseq____&quot;^15logseq____&quot;,[19,logseq____&quot;^11logseq____&quot;,logseq____&quot;Sep 4th, 2024logseq____&quot;,536870915]],[logseq____&quot;^15logseq____&quot;,[19,logseq____&quot;^Blogseq____&quot;,1725436529486,536870915]],[logseq____&quot;^15logseq____&quot;,[19,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-c0f1-4b01-9c15-9a1996116372logseq____&quot;,536870915]],[logseq____&quot;^15logseq____&quot;,[20,logseq____&quot;^Klogseq____&quot;,1725436529483,536870915]],[logseq____&quot;^15logseq____&quot;,[20,logseq____&quot;^@logseq____&quot;,false,536870915]],[logseq____&quot;^15logseq____&quot;,[20,logseq____&quot;^Ylogseq____&quot;,logseq____&quot;swingsetlogseq____&quot;,536870915]],[logseq____&quot;^15logseq____&quot;,[20,logseq____&quot;^11logseq____&quot;,logseq____&quot;SwingSetlogseq____&quot;,536870915]],[logseq____&quot;^15logseq____&quot;,[20,logseq____&quot;^Blogseq____&quot;,1725436529483,536870915]],[logseq____&quot;^15logseq____&quot;,[20,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-9846-4872-a50b-fcc5dd398d0dlogseq____&quot;,536870920]],[logseq____&quot;^15logseq____&quot;,[21,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;[[SwingSet]]logseq____&quot;,536870915]],[logseq____&quot;^15logseq____&quot;,[21,logseq____&quot;^Ologseq____&quot;,logseq____&quot;~:markdownlogseq____&quot;,536870915]],[logseq____&quot;^15logseq____&quot;,[21,logseq____&quot;^Flogseq____&quot;,19,536870915]],[logseq____&quot;^15logseq____&quot;,[21,logseq____&quot;^Xlogseq____&quot;,19,536870915]],[logseq____&quot;^15logseq____&quot;,[21,logseq____&quot;^Vlogseq____&quot;,19,536870915]],[logseq____&quot;^15logseq____&quot;,[21,logseq____&quot;^Ulogseq____&quot;,19,536870915]],[logseq____&quot;^15logseq____&quot;,[21,logseq____&quot;^Ulogseq____&quot;,20,536870915]],[logseq____&quot;^15logseq____&quot;,[21,logseq____&quot;^Hlogseq____&quot;,20,536870915]],[logseq____&quot;^15logseq____&quot;,[21,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-b9e4-4cc9-b81c-321a99c7154dlogseq____&quot;,536870915]],[logseq____&quot;^15logseq____&quot;,[22,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;logseq____&quot;,536870915]],[logseq____&quot;^15logseq____&quot;,[22,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870915]],[logseq____&quot;^15logseq____&quot;,[22,logseq____&quot;^Flogseq____&quot;,21,536870915]],[logseq____&quot;^15logseq____&quot;,[22,logseq____&quot;^Xlogseq____&quot;,19,536870915]],[logseq____&quot;^15logseq____&quot;,[22,logseq____&quot;^Vlogseq____&quot;,19,536870915]],[logseq____&quot;^15logseq____&quot;,[22,logseq____&quot;^Ulogseq____&quot;,19,536870915]],[logseq____&quot;^15logseq____&quot;,[22,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-3c18-449e-bd61-f196d33ebdealogseq____&quot;,536870915]],[logseq____&quot;^15logseq____&quot;,[26,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;logseq____&quot;,536870918]],[logseq____&quot;^15logseq____&quot;,[26,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870918]],[logseq____&quot;^15logseq____&quot;,[26,logseq____&quot;^Flogseq____&quot;,12,536870918]],[logseq____&quot;^15logseq____&quot;,[26,logseq____&quot;^Xlogseq____&quot;,12,536870918]],[logseq____&quot;^15logseq____&quot;,[26,logseq____&quot;^Vlogseq____&quot;,12,536870918]],[logseq____&quot;^15logseq____&quot;,[26,logseq____&quot;^Ulogseq____&quot;,12,536870918]],[logseq____&quot;^15logseq____&quot;,[26,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-1f7a-4d83-9c7d-8857e09e0ed0logseq____&quot;,536870918]],[logseq____&quot;^15logseq____&quot;,[28,logseq____&quot;^Klogseq____&quot;,1725436529741,536870919]],[logseq____&quot;^15logseq____&quot;,[28,logseq____&quot;^@logseq____&quot;,false,536870919]],[logseq____&quot;^15logseq____&quot;,[28,logseq____&quot;^Ylogseq____&quot;,logseq____&quot;code bundleslogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[28,logseq____&quot;^11logseq____&quot;,logseq____&quot;Code Bundleslogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[28,logseq____&quot;^Blogseq____&quot;,1725436529741,536870919]],[logseq____&quot;^15logseq____&quot;,[28,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-93d4-4e8b-aa96-71cbafe5050elogseq____&quot;,536870920]],[logseq____&quot;^15logseq____&quot;,[29,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;A bundle might be assembled piecemeal. If I want to give you a bundle, and you already have a number of similar bundles, we can compare the modules in each and figure out the ones my bundle needs but you donlogseq____&apos;t have yet. Then I can send you just the compartment map and the missing modules, and you can reassemble a functionally identical bundle. The bundle ID will be the same, the imported behavior will be the same, but the zipfile itself might be slightly different. This lets us minimize the amount of data transmitted and stored.logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[29,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[29,logseq____&quot;^Flogseq____&quot;,111,536870919]],[logseq____&quot;^15logseq____&quot;,[29,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[29,logseq____&quot;^Vlogseq____&quot;,46,536870919]],[logseq____&quot;^15logseq____&quot;,[29,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[29,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-ae42-457e-8d31-e3b6de03f274logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[30,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;the liveslots bundle ID is recorded separately for each vat, so liveslots can be upgraded (for new vats) without affecting the behavior of existing oneslogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[30,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[30,logseq____&quot;^Flogseq____&quot;,32,536870919]],[logseq____&quot;^15logseq____&quot;,[30,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[30,logseq____&quot;^Vlogseq____&quot;,93,536870919]],[logseq____&quot;^15logseq____&quot;,[30,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[30,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-0c32-40a8-ae73-40d3a7288e70logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[31,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;~`E(vatAdminService).waitForBundleCap(bundleID) -logseq____&gt; Promiselogseq____&lt;BundleCaplogseq____&gt;` (waits until installed)logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[31,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[31,logseq____&quot;^Flogseq____&quot;,44,536870919]],[logseq____&quot;^15logseq____&quot;,[31,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[31,logseq____&quot;^Vlogseq____&quot;,98,536870919]],[logseq____&quot;^15logseq____&quot;,[31,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[31,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-eb0b-4770-9565-e80a3f639e4flogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[32,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;each vat also has a \\logseq____&quot;liveslots\\logseq____&quot; layer, defined by a bundlelogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[32,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[32,logseq____&quot;^Flogseq____&quot;,132,536870919]],[logseq____&quot;^15logseq____&quot;,[32,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[32,logseq____&quot;^Vlogseq____&quot;,93,536870919]],[logseq____&quot;^15logseq____&quot;,[32,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[32,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-2913-441d-8039-454903ea6078logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[33,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;A bundle might be assembled piecemeal. If I want to give you a bundle, and you already have a number of similar bundles, we can compare the modules in each and figure out the ones my bundle needs but you donlogseq____&apos;t have yet. Then I can send you just the compartment map and the missing modules, and you can reassemble a functionally identical bundle. The bundle ID will be the same, the imported behavior will be the same, but the zipfile itself might be slightly different. This lets us minimize the amount of data transmitted and stored.logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[33,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[33,logseq____&quot;^Flogseq____&quot;,52,536870919]],[logseq____&quot;^15logseq____&quot;,[33,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[33,logseq____&quot;^Vlogseq____&quot;,55,536870919]],[logseq____&quot;^15logseq____&quot;,[33,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[33,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-3b7c-41e1-80c0-66654779dbfflogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[34,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;~`E(vatAdminService).waitForBundleCap(bundleID) -logseq____&gt; Promiselogseq____&lt;BundleCaplogseq____&gt;` (waits until installed)logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[34,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[34,logseq____&quot;^Flogseq____&quot;,78,536870919]],[logseq____&quot;^15logseq____&quot;,[34,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[34,logseq____&quot;^Vlogseq____&quot;,110,536870919]],[logseq____&quot;^15logseq____&quot;,[34,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[34,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-4eab-4408-978a-801a638ad023logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[35,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;Bundlecaps can be obtained from several methods of `vatAdminService`, which (as a vat) always returns a Promise.logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[35,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[35,logseq____&quot;^Flogseq____&quot;,62,536870919]],[logseq____&quot;^15logseq____&quot;,[35,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[35,logseq____&quot;^Vlogseq____&quot;,98,536870919]],[logseq____&quot;^15logseq____&quot;,[35,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[35,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-050a-4f2d-89a3-7e0f9241b659logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[36,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;## Bundle Installation at Runtimelogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[36,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[36,logseq____&quot;^Flogseq____&quot;,58,536870919]],[logseq____&quot;^15logseq____&quot;,[36,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[36,logseq____&quot;^Vlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[36,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[36,logseq____&quot;^?logseq____&quot;,[logseq____&quot;^ logseq____&quot;,logseq____&quot;~:headinglogseq____&quot;,2],536870919]],[logseq____&quot;^15logseq____&quot;,[36,logseq____&quot;^Jlogseq____&quot;,[],536870919]],[logseq____&quot;^15logseq____&quot;,[36,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-f6e8-4982-9f28-8c7c10f2785flogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[37,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;But once a bundlecap is obtained, the corresponding bundle is guaranteed to be available. We do not yet have GC for bundles, but once we do, each copy of the bundlecap will establish a reference count. As long as any bundlecap is still held, the bundle will be held too. Bundles will be deleted at some point after the last bundlecap is gone. (We need a story for what keeps the bundle alive between the external `controller.validateAndInstallBundle()` and some vat getting a bundlecap, but that interval is not expected to be very long, so we might just use explicit GC actions that we donlogseq____&apos;t run very often).logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[37,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[37,logseq____&quot;^Flogseq____&quot;,65,536870919]],[logseq____&quot;^15logseq____&quot;,[37,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[37,logseq____&quot;^Vlogseq____&quot;,120,536870919]],[logseq____&quot;^15logseq____&quot;,[37,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[37,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-dfd7-45e6-bf39-4560a9dfa9b1logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[38,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;# Code Bundleslogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[38,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[38,logseq____&quot;^Flogseq____&quot;,120,536870919]],[logseq____&quot;^15logseq____&quot;,[38,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[38,logseq____&quot;^Vlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[38,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[38,logseq____&quot;^?logseq____&quot;,[logseq____&quot;^ logseq____&quot;,logseq____&quot;^17logseq____&quot;,1],536870919]],[logseq____&quot;^15logseq____&quot;,[38,logseq____&quot;^Jlogseq____&quot;,[],536870919]],[logseq____&quot;^15logseq____&quot;,[38,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-8549-4f15-996e-946d7d7cff8blogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[39,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;each vat also has a \\logseq____&quot;liveslots\\logseq____&quot; layer, defined by a bundlelogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[39,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[39,logseq____&quot;^Flogseq____&quot;,64,536870919]],[logseq____&quot;^15logseq____&quot;,[39,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[39,logseq____&quot;^Vlogseq____&quot;,122,536870919]],[logseq____&quot;^15logseq____&quot;,[39,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[39,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-a9f0-412d-bdb6-7767152857c0logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[40,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;## Bundlecapslogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[40,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[40,logseq____&quot;^Flogseq____&quot;,46,536870919]],[logseq____&quot;^15logseq____&quot;,[40,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[40,logseq____&quot;^Vlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[40,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[40,logseq____&quot;^?logseq____&quot;,[logseq____&quot;^ logseq____&quot;,logseq____&quot;^17logseq____&quot;,2],536870919]],[logseq____&quot;^15logseq____&quot;,[40,logseq____&quot;^Jlogseq____&quot;,[],536870919]],[logseq____&quot;^15logseq____&quot;,[40,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-657b-439c-87a4-52e10dc1651elogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[41,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;Once you have a bundlecap, the full set of things you can do with it are:logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[41,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[41,logseq____&quot;^Flogseq____&quot;,71,536870919]],[logseq____&quot;^15logseq____&quot;,[41,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[41,logseq____&quot;^Vlogseq____&quot;,98,536870919]],[logseq____&quot;^15logseq____&quot;,[41,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[41,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-3ee6-4aa7-9826-42ec78b6590alogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[42,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;## What Is A Bundle?logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[42,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[42,logseq____&quot;^Flogseq____&quot;,73,536870919]],[logseq____&quot;^15logseq____&quot;,[42,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[42,logseq____&quot;^Vlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[42,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[42,logseq____&quot;^?logseq____&quot;,[logseq____&quot;^ logseq____&quot;,logseq____&quot;^17logseq____&quot;,2],536870919]],[logseq____&quot;^15logseq____&quot;,[42,logseq____&quot;^Jlogseq____&quot;,[],536870919]],[logseq____&quot;^15logseq____&quot;,[42,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-66b4-45ae-8f91-4f2ccc52054alogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[43,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;Once the bundle is installed, the external caller can send a vat-level message with the bundle ID to some vat within the kernel. The receiving vat can then do `E(vatAdminService).getBundleCap(bundleID) -logseq____&gt; bundleCap` to get a handle from which vats can be created.logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[43,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[43,logseq____&quot;^Flogseq____&quot;,143,536870919]],[logseq____&quot;^15logseq____&quot;,[43,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[43,logseq____&quot;^Vlogseq____&quot;,36,536870919]],[logseq____&quot;^15logseq____&quot;,[43,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[43,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-5519-4a00-9a0b-72be0b08abb7logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[44,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;* `E(vatAdminService).getBundleCap(bundleID) -logseq____&gt; Promiselogseq____&lt;BundleCaplogseq____&gt;` (rejects if not installed yet)logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[44,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[44,logseq____&quot;^Flogseq____&quot;,35,536870919]],[logseq____&quot;^15logseq____&quot;,[44,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[44,logseq____&quot;^Vlogseq____&quot;,98,536870919]],[logseq____&quot;^15logseq____&quot;,[44,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[44,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-22f0-4708-b505-b25ba9c4145alogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[45,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;~`D(bundleCap).getBundle() -logseq____&gt; bundle object`: if you really need the full bundle, i.e. for `importBundle()`logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[45,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[45,logseq____&quot;^Flogseq____&quot;,113,536870919]],[logseq____&quot;^15logseq____&quot;,[45,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[45,logseq____&quot;^Vlogseq____&quot;,41,536870919]],[logseq____&quot;^15logseq____&quot;,[45,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[45,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-885f-42d9-93d2-2418f77c57e2logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[46,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;## BundleIDslogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[46,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[46,logseq____&quot;^Flogseq____&quot;,67,536870919]],[logseq____&quot;^15logseq____&quot;,[46,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[46,logseq____&quot;^Vlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[46,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[46,logseq____&quot;^?logseq____&quot;,[logseq____&quot;^ logseq____&quot;,logseq____&quot;^17logseq____&quot;,2],536870919]],[logseq____&quot;^15logseq____&quot;,[46,logseq____&quot;^Jlogseq____&quot;,[],536870919]],[logseq____&quot;^15logseq____&quot;,[46,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-f421-4c10-b91e-07dc968e3802logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[47,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;Bundlecaps are new device nodes created by the vatAdmin device. Internally, this device remembers the mapping from bundle ID to the device node ID (`dref`), and vice versa, in a pair of vatstore state entries. This mapping is not held in RAM: the state entries are looked up on each call to `getBundleID`/etc. The device can also access the kernelKeeper APIs to convert bundle IDs into full bundles, if requested.logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[47,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[47,logseq____&quot;^Flogseq____&quot;,88,536870919]],[logseq____&quot;^15logseq____&quot;,[47,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[47,logseq____&quot;^Vlogseq____&quot;,140,536870919]],[logseq____&quot;^15logseq____&quot;,[47,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[47,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-c176-488a-b8ab-4f8d4219061dlogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[48,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;When defining a static vat in the Swingset `config.vats` object, the filename provided as `sourceSpec` is turned into a bundle, the bundle is installed into the bundle table, and resulting bundle ID is stored in the vatlogseq____&apos;s database record. When the static vat is launched, the DB record provides the bundle ID, and the bundle is loaded and evaluated in a new vat worker.logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[48,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[48,logseq____&quot;^Flogseq____&quot;,66,536870919]],[logseq____&quot;^15logseq____&quot;,[48,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[48,logseq____&quot;^Vlogseq____&quot;,66,536870919]],[logseq____&quot;^15logseq____&quot;,[48,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[48,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-061f-44e0-8544-dd593a6e4152logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[49,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;The `bundleSource()` function takes a filename of the entry point module and returns (a promise for) the code bundle object. It generally needs disk access to find all the imports.logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[49,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[49,logseq____&quot;^Flogseq____&quot;,112,536870919]],[logseq____&quot;^15logseq____&quot;,[49,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[49,logseq____&quot;^Vlogseq____&quot;,42,536870919]],[logseq____&quot;^15logseq____&quot;,[49,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[49,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-fe10-40ed-8f96-a2ea1e679bcflogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[50,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;Bundlecaps are new device nodes created by the vatAdmin device. Internally, this device remembers the mapping from bundle ID to the device node ID (`dref`), and vice versa, in a pair of vatstore state entries. This mapping is not held in RAM: the state entries are looked up on each call to `getBundleID`/etc. The device can also access the kernelKeeper APIs to convert bundle IDs into full bundles, if requested.logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[50,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[50,logseq____&quot;^Flogseq____&quot;,106,536870919]],[logseq____&quot;^15logseq____&quot;,[50,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[50,logseq____&quot;^Vlogseq____&quot;,124,536870919]],[logseq____&quot;^15logseq____&quot;,[50,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[50,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-6fd6-47fa-a285-1f78b4983639logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[51,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;==The `importBundle()` function takes a bundle object and evaluates it, returning (a promise for) a \\logseq____&quot;module namespace object\\logseq____&quot;, which contains all the exports of the entry-point module. You can think of `importBundle()` as what Node.js effectively does when you run `node ./foo.js`: it does the equivalent of `bundleSource()` followed by an immediate `importBundle()`, ignoring the exported symbols but executing everything in `foo.js` as a side-effect.==logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[51,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[51,logseq____&quot;^Flogseq____&quot;,49,536870919]],[logseq____&quot;^15logseq____&quot;,[51,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[51,logseq____&quot;^Vlogseq____&quot;,42,536870919]],[logseq____&quot;^15logseq____&quot;,[51,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[51,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-c5aa-4e8e-89ee-a8ceb655356blogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[52,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;==We define the \\logseq____&quot;bundle ID\\logseq____&quot; as a hash of the bundlelogseq____&apos;s compartment map file==, specifically the fixed string `b1-` followed by the lowercase hex encoding of the SHA512 hash of the compartment map file. The compartment map includes hashes of all the modules included in the bundle, and the validation process ensures that the bundle contains exactly the expected set of modules. So the bundle ID is a strong identifier of the contents of the bundle, which is not sensitive to the order of the zipfile contents.logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[52,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[52,logseq____&quot;^Flogseq____&quot;,55,536870919]],[logseq____&quot;^15logseq____&quot;,[52,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[52,logseq____&quot;^Vlogseq____&quot;,55,536870919]],[logseq____&quot;^15logseq____&quot;,[52,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[52,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-bb47-4172-a530-79affdd719d3logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[53,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;~`D(bundleCap).getBundleID() -logseq____&gt; string`: to get the bundle IDlogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[53,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[53,logseq____&quot;^Flogseq____&quot;,72,536870919]],[logseq____&quot;^15logseq____&quot;,[53,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[53,logseq____&quot;^Vlogseq____&quot;,72,536870919]],[logseq____&quot;^15logseq____&quot;,[53,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[53,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-cf10-4bf5-92fe-dee34ba8f21blogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[54,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;The `config.bundles` object maps names to a bundle specification. These bundles are installed as above, and then a special \\logseq____&quot;named bundles\\logseq____&quot; table is updated with the name-to-bundle-ID mapping. These names are available to `E(vatAdminService).getNamedBundleCap(name) -logseq____&gt; bundleCap` and `E(vatAdminService).getBundleIDByName(name) -logseq____&gt; bundleID`. For example, the chainlogseq____&apos;s \\logseq____&quot;core bootstrap\\logseq____&quot; code will use this to define bundles for the core vats (Zoe, etc), and create dynamic vats at bootstrap time from them. It will also provide Zoe with the bundlecap for ZCF this way, so Zoe can later create dynamic ZCF vats. `E(vatAdminService).createVatByName(name)` will continue to be supported until core-bootstrap is updated to retrieve bundlecaps, after which vat-admin will drop `createVatByName` and only support `createVat(bundleCap)`.logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[54,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[54,logseq____&quot;^Flogseq____&quot;,134,536870919]],[logseq____&quot;^15logseq____&quot;,[54,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[54,logseq____&quot;^Vlogseq____&quot;,58,536870919]],[logseq____&quot;^15logseq____&quot;,[54,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[54,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-3a4b-4114-8c5a-149b9b6bd3a8logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[55,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;## BundleIDslogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[55,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[55,logseq____&quot;^Flogseq____&quot;,42,536870919]],[logseq____&quot;^15logseq____&quot;,[55,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[55,logseq____&quot;^Vlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[55,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[55,logseq____&quot;^?logseq____&quot;,[logseq____&quot;^ logseq____&quot;,logseq____&quot;^17logseq____&quot;,2],536870919]],[logseq____&quot;^15logseq____&quot;,[55,logseq____&quot;^Jlogseq____&quot;,[],536870919]],[logseq____&quot;^15logseq____&quot;,[55,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-118c-4610-af7c-eb9ecd02e807logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[56,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;In a given workspace (e.g. a Git checkout / working tree), you will have a hierarchy of `node_modules/` directories which contain the packages and modules that can be imported. So when `foo.js` says `import { x } from logseq____&apos;../bar.jslogseq____&apos;`, it will get code from a neighboring file, and when it says `import { y } from logseq____&apos;otherpackagelogseq____&apos;`, it will get code from somewhere in the `node_modules` directory.logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[56,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[56,logseq____&quot;^Flogseq____&quot;,137,536870919]],[logseq____&quot;^15logseq____&quot;,[56,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[56,logseq____&quot;^Vlogseq____&quot;,42,536870919]],[logseq____&quot;^15logseq____&quot;,[56,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[56,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-7aab-4b57-b624-a58801b939e8logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[57,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;the kernel source code itself is stored in a bundle, to make it easier to switch from one version of the kernel to another at a pre-determined timelogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[57,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[57,logseq____&quot;^Flogseq____&quot;,80,536870919]],[logseq____&quot;^15logseq____&quot;,[57,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[57,logseq____&quot;^Vlogseq____&quot;,122,536870919]],[logseq____&quot;^15logseq____&quot;,[57,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[57,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-6496-4950-94e1-99c81472052elogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[58,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;## Bundle Installation Through Configlogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[58,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[58,logseq____&quot;^Flogseq____&quot;,93,536870919]],[logseq____&quot;^15logseq____&quot;,[58,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[58,logseq____&quot;^Vlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[58,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[58,logseq____&quot;^?logseq____&quot;,[logseq____&quot;^ logseq____&quot;,logseq____&quot;^17logseq____&quot;,2],536870919]],[logseq____&quot;^15logseq____&quot;,[58,logseq____&quot;^Jlogseq____&quot;,[],536870919]],[logseq____&quot;^15logseq____&quot;,[58,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-ef13-4e13-82b2-fb99ec32fd14logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[59,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;all swingset vats, both static and dynamic, start from a bundlelogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[59,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[59,logseq____&quot;^Flogseq____&quot;,108,536870919]],[logseq____&quot;^15logseq____&quot;,[59,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[59,logseq____&quot;^Vlogseq____&quot;,93,536870919]],[logseq____&quot;^15logseq____&quot;,[59,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[59,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-be07-4695-9ff0-dbed5d21a33elogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[60,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;By moving bundle installation into a separate external interface, vat-level messages can remain small. Currently the only place the full bundle will appear is in a vat transcript, in the results of the syscall that implements `D(bundleCap).getBundle()`, when userspace needs to do an `importBundle()` directly, and we hope to remove even that copy in the future.logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[60,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[60,logseq____&quot;^Flogseq____&quot;,91,536870919]],[logseq____&quot;^15logseq____&quot;,[60,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[60,logseq____&quot;^Vlogseq____&quot;,36,536870919]],[logseq____&quot;^15logseq____&quot;,[60,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[60,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-927b-4f03-9cb5-921e281e181flogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[61,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;The `bundleSource()` function takes a filename of the entry point module and returns (a promise for) the code bundle object. It generally needs disk access to find all the imports.logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[61,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[61,logseq____&quot;^Flogseq____&quot;,102,536870919]],[logseq____&quot;^15logseq____&quot;,[61,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[61,logseq____&quot;^Vlogseq____&quot;,67,536870919]],[logseq____&quot;^15logseq____&quot;,[61,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[61,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-f3d2-47be-929d-7c83cff2717dlogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[62,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;Userspace works with bundlecaps, which can be passed through eventual-sends from one vat to another and stored in collections (and virtual objects). Internally, each bundlecap wraps a bundle ID.logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[62,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[62,logseq____&quot;^Flogseq____&quot;,98,536870919]],[logseq____&quot;^15logseq____&quot;,[62,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[62,logseq____&quot;^Vlogseq____&quot;,98,536870919]],[logseq____&quot;^15logseq____&quot;,[62,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[62,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-2269-4d75-93f7-3c53cc6af06flogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[63,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;Userspace works with bundlecaps, which can be passed through eventual-sends from one vat to another and stored in collections (and virtual objects). Internally, each bundlecap wraps a bundle ID.logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[63,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[63,logseq____&quot;^Flogseq____&quot;,110,536870919]],[logseq____&quot;^15logseq____&quot;,[63,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[63,logseq____&quot;^Vlogseq____&quot;,110,536870919]],[logseq____&quot;^15logseq____&quot;,[63,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[63,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-a688-4608-bade-5c117f15e7e2logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[64,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;this could also be used as part of an in-vat upgrade process, to load new behaviorlogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[64,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[64,logseq____&quot;^Flogseq____&quot;,101,536870919]],[logseq____&quot;^15logseq____&quot;,[64,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[64,logseq____&quot;^Vlogseq____&quot;,122,536870919]],[logseq____&quot;^15logseq____&quot;,[64,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[64,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-fd3a-4a0b-87c7-2226f740c15clogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[65,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;Bundle installation is a transactional event: it must happen, and be committed, before the bundle is available. `E(vatAdminService).getBundleCap(bundleID)` will fail (consistently) if the bundle was not already installed. Host applications (like a chain) should perform `validateAndInstallBundle()` from within a transaction, so all validators maintain consensus about whether the bundle is installed or not.logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[65,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[65,logseq____&quot;^Flogseq____&quot;,120,536870919]],[logseq____&quot;^15logseq____&quot;,[65,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[65,logseq____&quot;^Vlogseq____&quot;,120,536870919]],[logseq____&quot;^15logseq____&quot;,[65,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[65,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-6dda-4ad2-9788-84709a821975logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[66,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;## Bundle Installation Through Configlogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[66,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[66,logseq____&quot;^Flogseq____&quot;,76,536870919]],[logseq____&quot;^15logseq____&quot;,[66,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[66,logseq____&quot;^Vlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[66,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[66,logseq____&quot;^?logseq____&quot;,[logseq____&quot;^ logseq____&quot;,logseq____&quot;^17logseq____&quot;,2],536870919]],[logseq____&quot;^15logseq____&quot;,[66,logseq____&quot;^Jlogseq____&quot;,[],536870919]],[logseq____&quot;^15logseq____&quot;,[66,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-4866-4520-955b-279ad032ed4elogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[67,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;## What Is A Bundle?logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[67,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[67,logseq____&quot;^Flogseq____&quot;,38,536870919]],[logseq____&quot;^15logseq____&quot;,[67,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[67,logseq____&quot;^Vlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[67,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[67,logseq____&quot;^?logseq____&quot;,[logseq____&quot;^ logseq____&quot;,logseq____&quot;^17logseq____&quot;,2],536870919]],[logseq____&quot;^15logseq____&quot;,[67,logseq____&quot;^Jlogseq____&quot;,[],536870919]],[logseq____&quot;^15logseq____&quot;,[67,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-1725-42c6-8946-2f678012ed3elogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[68,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;The swingset kernel provides tools to install, reference, and evaluate \\logseq____&quot;Code Bundles\\logseq____&quot;. Vats can be created from a bundle, and vats can pass around \\logseq____&quot;bundlecaps\\logseq____&quot; to refer to previously-installed bundles. Using bundlecaps is much more efficient than passing the entire (large) bundle object through messages.logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[68,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[68,logseq____&quot;^Flogseq____&quot;,38,536870919]],[logseq____&quot;^15logseq____&quot;,[68,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[68,logseq____&quot;^Vlogseq____&quot;,38,536870919]],[logseq____&quot;^15logseq____&quot;,[68,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[68,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-7cf0-465d-a425-d9d4227c61c6logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[69,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;The vatAdmin vatlogseq____&apos;s `createVat` method accepts bundlecaps (or full bundles, for now). The vatAdmin device (which is wrapped tightly by vatAdminVat and not exposed to anyone else) accepts bundle IDs. VatAdminDevice translates bundlecaps into bundle IDs before talking to the device.logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[69,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[69,logseq____&quot;^Flogseq____&quot;,47,536870919]],[logseq____&quot;^15logseq____&quot;,[69,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[69,logseq____&quot;^Vlogseq____&quot;,140,536870919]],[logseq____&quot;^15logseq____&quot;,[69,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[69,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-0ead-45d2-8aaa-aa214768aaa0logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[70,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;through `vatAdminService~.getBundleCap()`, vat code can exchange a bundle ID for a bundlecaplogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[70,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[70,logseq____&quot;^Flogseq____&quot;,105,536870919]],[logseq____&quot;^15logseq____&quot;,[70,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[70,logseq____&quot;^Vlogseq____&quot;,122,536870919]],[logseq____&quot;^15logseq____&quot;,[70,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[70,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-9c91-486a-b4d6-8e57b084b85elogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[71,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;Note that the `waitForBundleCap()` method will wait (possibly forever) for the bundle ID to be installed before resolving its Promise, so the Promise will never resolve to `undefined`.logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[71,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[71,logseq____&quot;^Flogseq____&quot;,144,536870919]],[logseq____&quot;^15logseq____&quot;,[71,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[71,logseq____&quot;^Vlogseq____&quot;,98,536870919]],[logseq____&quot;^15logseq____&quot;,[71,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[71,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-16c6-4ede-8104-20d3ab813ea3logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[72,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;Once you have a bundlecap, the full set of things you can do with it are:logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[72,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[72,logseq____&quot;^Flogseq____&quot;,85,536870919]],[logseq____&quot;^15logseq____&quot;,[72,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[72,logseq____&quot;^Vlogseq____&quot;,110,536870919]],[logseq____&quot;^15logseq____&quot;,[72,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[72,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-31b5-4a62-8323-0993eac612e8logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[73,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;## Code Bundleslogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[73,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[73,logseq____&quot;^Flogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[73,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[73,logseq____&quot;^Vlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[73,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[73,logseq____&quot;^?logseq____&quot;,[logseq____&quot;^ logseq____&quot;,logseq____&quot;^17logseq____&quot;,2],536870919]],[logseq____&quot;^15logseq____&quot;,[73,logseq____&quot;^Jlogseq____&quot;,[],536870919]],[logseq____&quot;^15logseq____&quot;,[73,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-bb43-486f-b3a2-9b0ef6c10271logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[74,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;If you point at a single \\logseq____&quot;entry point\\logseq____&quot; module, and chase down all the `import` statements, youlogseq____&apos;ll find some other set of module files. Following the transitive `import` statements leads to a collection of modules and a linkage map which remembers how they are wired together.logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[74,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[74,logseq____&quot;^Flogseq____&quot;,56,536870919]],[logseq____&quot;^15logseq____&quot;,[74,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[74,logseq____&quot;^Vlogseq____&quot;,42,536870919]],[logseq____&quot;^15logseq____&quot;,[74,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[74,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-9f1a-4c7b-a128-76067e7ae92clogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[75,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;Once the kernel is up and running, new bundles can be installed with the `controller.validateAndInstallBundle()` interface. This accepts a bundle and an optional alleged bundle ID. It performs validity checks: if the ID is provided but does not match the compartment map, or if (TODO) the bundle contents do not match the compartment map, or if (TODO) the contents do not parse as JavaScript modules, then it will throw. If everything looks good, it will install the bundle into the table and return the computed bundle ID.logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[75,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[75,logseq____&quot;^Flogseq____&quot;,123,536870919]],[logseq____&quot;^15logseq____&quot;,[75,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[75,logseq____&quot;^Vlogseq____&quot;,123,536870919]],[logseq____&quot;^15logseq____&quot;,[75,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[75,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-40e2-463f-878b-4cdd10cf8982logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[76,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;## Bundlecapslogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[76,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[76,logseq____&quot;^Flogseq____&quot;,55,536870919]],[logseq____&quot;^15logseq____&quot;,[76,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[76,logseq____&quot;^Vlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[76,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[76,logseq____&quot;^?logseq____&quot;,[logseq____&quot;^ logseq____&quot;,logseq____&quot;^17logseq____&quot;,2],536870919]],[logseq____&quot;^15logseq____&quot;,[76,logseq____&quot;^Jlogseq____&quot;,[],536870919]],[logseq____&quot;^15logseq____&quot;,[76,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-e252-4a91-bcc6-3674d9c03697logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[77,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;The `initializeSwingset()` function, called when the host application is first configured, creates bundles for built-in vats and devices (timer, vatAdmin, mailbox), as well as liveslots and the kernel, and installs them into the table as well. Internally, the kernel remembers the bundle ID of each one for later use.logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[77,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[77,logseq____&quot;^Flogseq____&quot;,82,536870919]],[logseq____&quot;^15logseq____&quot;,[77,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[77,logseq____&quot;^Vlogseq____&quot;,66,536870919]],[logseq____&quot;^15logseq____&quot;,[77,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[77,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-0c5f-4550-b7c6-168995a820e7logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[78,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;* `E(vatAdminService).getBundleCap(bundleID) -logseq____&gt; Promiselogseq____&lt;BundleCaplogseq____&gt;` (rejects if not installed yet)logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[78,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[78,logseq____&quot;^Flogseq____&quot;,97,536870919]],[logseq____&quot;^15logseq____&quot;,[78,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[78,logseq____&quot;^Vlogseq____&quot;,110,536870919]],[logseq____&quot;^15logseq____&quot;,[78,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[78,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-a6a8-487a-9035-289a759fe6f6logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[79,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;## Determinismlogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[79,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[79,logseq____&quot;^Flogseq____&quot;,124,536870919]],[logseq____&quot;^15logseq____&quot;,[79,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[79,logseq____&quot;^Vlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[79,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[79,logseq____&quot;^?logseq____&quot;,[logseq____&quot;^ logseq____&quot;,logseq____&quot;^17logseq____&quot;,2],536870919]],[logseq____&quot;^15logseq____&quot;,[79,logseq____&quot;^Jlogseq____&quot;,[],536870919]],[logseq____&quot;^15logseq____&quot;,[79,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-288f-40b7-b0a8-e7465fd5a452logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[80,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;swingset devices are defined by bundles that are stored in the bundle tablelogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[80,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[80,logseq____&quot;^Flogseq____&quot;,114,536870919]],[logseq____&quot;^15logseq____&quot;,[80,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[80,logseq____&quot;^Vlogseq____&quot;,122,536870919]],[logseq____&quot;^15logseq____&quot;,[80,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[80,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-df6f-4755-a7c3-44ea50c17507logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[81,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;The `importBundle()` function takes a bundle object and evaluates it, returning (a promise for) a \\logseq____&quot;module namespace object\\logseq____&quot;, which contains all the exports of the entry-point module. You can think of `importBundle()` as what Node.js effectively does when you run `node ./foo.js`: it does the equivalent of `bundleSource()` followed by an immediate `importBundle()`, ignoring the exported symbols but executing everything in `foo.js` as a side-effect.logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[81,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[81,logseq____&quot;^Flogseq____&quot;,61,536870919]],[logseq____&quot;^15logseq____&quot;,[81,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[81,logseq____&quot;^Vlogseq____&quot;,67,536870919]],[logseq____&quot;^15logseq____&quot;,[81,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[81,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-5791-40a5-a044-ed05bcedd95clogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[82,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;The `config.bundles` object maps names to a bundle specification. These bundles are installed as above, and then a special \\logseq____&quot;named bundles\\logseq____&quot; table is updated with the name-to-bundle-ID mapping. These names are available to `E(vatAdminService).getNamedBundleCap(name) -logseq____&gt; bundleCap` and `E(vatAdminService).getBundleIDByName(name) -logseq____&gt; bundleID`. For example, the chainlogseq____&apos;s \\logseq____&quot;core bootstrap\\logseq____&quot; code will use this to define bundles for the core vats (Zoe, etc), and create dynamic vats at bootstrap time from them. It will also provide Zoe with the bundlecap for ZCF this way, so Zoe can later create dynamic ZCF vats. `E(vatAdminService).createVatByName(name)` will continue to be supported until core-bootstrap is updated to retrieve bundlecaps, after which vat-admin will drop `createVatByName` and only support `createVat(bundleCap)`.logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[82,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[82,logseq____&quot;^Flogseq____&quot;,48,536870919]],[logseq____&quot;^15logseq____&quot;,[82,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[82,logseq____&quot;^Vlogseq____&quot;,66,536870919]],[logseq____&quot;^15logseq____&quot;,[82,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[82,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-d055-47e3-9825-0f5e188e172dlogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[83,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;the Zoe \\logseq____&quot;ZCF\\logseq____&quot; facet uses this to load contract code within an existing vatlogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[83,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[83,logseq____&quot;^Flogseq____&quot;,139,536870919]],[logseq____&quot;^15logseq____&quot;,[83,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[83,logseq____&quot;^Vlogseq____&quot;,93,536870919]],[logseq____&quot;^15logseq____&quot;,[83,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[83,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-689c-44db-9f22-bd4ab35bcf52logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[84,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;through `vatAdminService~.getBundleCap()`, vat code can exchange a bundle ID for a bundlecaplogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[84,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[84,logseq____&quot;^Flogseq____&quot;,107,536870919]],[logseq____&quot;^15logseq____&quot;,[84,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[84,logseq____&quot;^Vlogseq____&quot;,93,536870919]],[logseq____&quot;^15logseq____&quot;,[84,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[84,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-d657-4b7f-adb3-83194cde00e0logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[85,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;~`E(vatAdminService).getBundleIDByName(name) -logseq____&gt; Promiselogseq____&lt;stringlogseq____&gt;` (rejects if not registered)logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[85,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[85,logseq____&quot;^Flogseq____&quot;,119,536870919]],[logseq____&quot;^15logseq____&quot;,[85,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[85,logseq____&quot;^Vlogseq____&quot;,110,536870919]],[logseq____&quot;^15logseq____&quot;,[85,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[85,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-e115-4a3d-8546-5525132bf89flogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[86,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;The vatAdmin vatlogseq____&apos;s `createVat` method accepts bundlecaps (or full bundles, for now). The vatAdmin device (which is wrapped tightly by vatAdminVat and not exposed to anyone else) accepts bundle IDs. VatAdminDevice translates bundlecaps into bundle IDs before talking to the device.logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[86,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[86,logseq____&quot;^Flogseq____&quot;,50,536870919]],[logseq____&quot;^15logseq____&quot;,[86,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[86,logseq____&quot;^Vlogseq____&quot;,124,536870919]],[logseq____&quot;^15logseq____&quot;,[86,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[86,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-a621-4451-802c-a8b9dcd6274dlogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[87,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;Once the bundle is installed, the external caller can send a vat-level message with the bundle ID to some vat within the kernel. The receiving vat can then do `E(vatAdminService).getBundleCap(bundleID) -logseq____&gt; bundleCap` to get a handle from which vats can be created.logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[87,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[87,logseq____&quot;^Flogseq____&quot;,75,536870919]],[logseq____&quot;^15logseq____&quot;,[87,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[87,logseq____&quot;^Vlogseq____&quot;,123,536870919]],[logseq____&quot;^15logseq____&quot;,[87,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[87,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-cc11-4525-a278-d957cf487520logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[88,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;The kvStore has a subset of the key space reserved for holding bundles (mapping bundle ID to the JSON-encoded bundle). Another keyspace holds mapping from bundle name to bundle ID for the named bundles. These are accessed through `kernelKeeper` methods.logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[88,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[88,logseq____&quot;^Flogseq____&quot;,140,536870919]],[logseq____&quot;^15logseq____&quot;,[88,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[88,logseq____&quot;^Vlogseq____&quot;,140,536870919]],[logseq____&quot;^15logseq____&quot;,[88,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[88,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-c3b1-42e0-aac3-e8126a58bd72logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[89,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;The swingset kernel maintains a \\logseq____&quot;bundle table\\logseq____&quot; in the kernel database. Bundles can be installed here, indexed by their bundle ID, and retrieved for various purposes:logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[89,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[89,logseq____&quot;^Flogseq____&quot;,122,536870919]],[logseq____&quot;^15logseq____&quot;,[89,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[89,logseq____&quot;^Vlogseq____&quot;,122,536870919]],[logseq____&quot;^15logseq____&quot;,[89,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[89,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-e49c-49ca-b457-d07aaf0238bflogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[90,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;By moving bundle installation into a separate external interface, vat-level messages can remain small. Currently the only place the full bundle will appear is in a vat transcript, in the results of the syscall that implements `D(bundleCap).getBundle()`, when userspace needs to do an `importBundle()` directly, and we hope to remove even that copy in the future.logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[90,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[90,logseq____&quot;^Flogseq____&quot;,118,536870919]],[logseq____&quot;^15logseq____&quot;,[90,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[90,logseq____&quot;^Vlogseq____&quot;,123,536870919]],[logseq____&quot;^15logseq____&quot;,[90,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[90,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-3710-4bee-afd6-742bbc95174blogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[91,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;A future version of this interface will expose enough information to install individual modules first, and then \\logseq____&quot;install\\logseq____&quot; a bundle from just the compartment map contents (after checking that all the required modules are already present).logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[91,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[91,logseq____&quot;^Flogseq____&quot;,43,536870919]],[logseq____&quot;^15logseq____&quot;,[91,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[91,logseq____&quot;^Vlogseq____&quot;,36,536870919]],[logseq____&quot;^15logseq____&quot;,[91,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[91,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-810c-47fc-ad8a-5a6ad56069c2logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[92,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;A \\logseq____&quot;bundlecap\\logseq____&quot; is an object (specifically a swingset \\logseq____&quot;device node\\logseq____&quot;) which identifies a specific installed bundle. Bundlecaps only exist within swingset vats. Each bundlecap knows the bundle ID to which it refers. There is at most one bundlecap per bundle ID. It is not possible to make a bundlecap for a bundle that is not yet installed into the enclosing kernel, and holding a bundlecap guarantees that the bundle will be available (bundles may be GCed, but the bundlecap holds a reference that inhibits collection).logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[92,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[92,logseq____&quot;^Flogseq____&quot;,40,536870919]],[logseq____&quot;^15logseq____&quot;,[92,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[92,logseq____&quot;^Vlogseq____&quot;,40,536870919]],[logseq____&quot;^15logseq____&quot;,[92,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[92,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-65f4-4965-a2d9-5a929dd4d5b9logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[93,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;## How Swingset Uses Bundleslogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[93,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[93,logseq____&quot;^Flogseq____&quot;,40,536870919]],[logseq____&quot;^15logseq____&quot;,[93,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[93,logseq____&quot;^Vlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[93,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[93,logseq____&quot;^?logseq____&quot;,[logseq____&quot;^ logseq____&quot;,logseq____&quot;^17logseq____&quot;,2],536870919]],[logseq____&quot;^15logseq____&quot;,[93,logseq____&quot;^Jlogseq____&quot;,[],536870919]],[logseq____&quot;^15logseq____&quot;,[93,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-106a-4fbc-97ec-319539816482logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[94,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;~`E(vatAdminService).createVat(bundleCap)`: create a new dynamic vat from the bundlelogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[94,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[94,logseq____&quot;^Flogseq____&quot;,115,536870919]],[logseq____&quot;^15logseq____&quot;,[94,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[94,logseq____&quot;^Vlogseq____&quot;,72,536870919]],[logseq____&quot;^15logseq____&quot;,[94,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[94,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-2f36-4fa1-9f39-d03a72b05625logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[95,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;The `initializeSwingset()` function, called when the host application is first configured, creates bundles for built-in vats and devices (timer, vatAdmin, mailbox), as well as liveslots and the kernel, and installs them into the table as well. Internally, the kernel remembers the bundle ID of each one for later use.logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[95,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[95,logseq____&quot;^Flogseq____&quot;,54,536870919]],[logseq____&quot;^15logseq____&quot;,[95,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[95,logseq____&quot;^Vlogseq____&quot;,58,536870919]],[logseq____&quot;^15logseq____&quot;,[95,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[95,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-dc87-4e3d-a731-7f9775bea7bflogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[96,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;userspace can use `D(bundleCap).getBundle()` to fetch the bundle itself, for use with an `importBundle()` that does not create an entire new vatlogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[96,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[96,logseq____&quot;^Flogseq____&quot;,130,536870919]],[logseq____&quot;^15logseq____&quot;,[96,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[96,logseq____&quot;^Vlogseq____&quot;,122,536870919]],[logseq____&quot;^15logseq____&quot;,[96,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[96,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-fe99-4fed-88e5-4d6f630b9a03logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[97,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;Bundlecaps can be obtained from several methods of `vatAdminService`, which (as a vat) always returns a Promise.logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[97,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[97,logseq____&quot;^Flogseq____&quot;,63,536870919]],[logseq____&quot;^15logseq____&quot;,[97,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[97,logseq____&quot;^Vlogseq____&quot;,110,536870919]],[logseq____&quot;^15logseq____&quot;,[97,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[97,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-31eb-4865-8477-a0a4d3b4b608logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[98,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;## Using Bundlecapslogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[98,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[98,logseq____&quot;^Flogseq____&quot;,123,536870919]],[logseq____&quot;^15logseq____&quot;,[98,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[98,logseq____&quot;^Vlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[98,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[98,logseq____&quot;^?logseq____&quot;,[logseq____&quot;^ logseq____&quot;,logseq____&quot;^17logseq____&quot;,2],536870919]],[logseq____&quot;^15logseq____&quot;,[98,logseq____&quot;^Jlogseq____&quot;,[],536870919]],[logseq____&quot;^15logseq____&quot;,[98,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-a552-4c7b-9cab-a4cc3b119c0elogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[99,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;Bundles are interesting because they can be serialized and sent to a remote system. They can be saved in a database and instantiated (evaluated/imported) later, possibly multiple times.logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[99,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[99,logseq____&quot;^Flogseq____&quot;,51,536870919]],[logseq____&quot;^15logseq____&quot;,[99,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[99,logseq____&quot;^Vlogseq____&quot;,42,536870919]],[logseq____&quot;^15logseq____&quot;,[99,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[99,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-de71-4462-aea1-14b655fa8e88logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[100,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;swingset devices are defined by bundles that are stored in the bundle tablelogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[100,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[100,logseq____&quot;^Flogseq____&quot;,30,536870919]],[logseq____&quot;^15logseq____&quot;,[100,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[100,logseq____&quot;^Vlogseq____&quot;,93,536870919]],[logseq____&quot;^15logseq____&quot;,[100,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[100,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-4d87-4759-ae15-51551bd66219logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[101,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;the Zoe \\logseq____&quot;ZCF\\logseq____&quot; facet uses this to load contract code within an existing vatlogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[101,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[101,logseq____&quot;^Flogseq____&quot;,96,536870919]],[logseq____&quot;^15logseq____&quot;,[101,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[101,logseq____&quot;^Vlogseq____&quot;,122,536870919]],[logseq____&quot;^15logseq____&quot;,[101,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[101,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-ce00-43cc-8418-5a2c83007bf1logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[102,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;A \\logseq____&quot;code bundle\\logseq____&quot; is a data structure that captures the contents of these modules and the linkage map (called a \\logseq____&quot;compartment map\\logseq____&quot;). Bundles are JSON-serializable objects, with one mandatory string property named `moduleFormat`, and other properties that depend on the format. Typically there is exactly one other property, and its value is a very large string (1-2 MB is common). Our bundles use a format defined by [Endo](https://github.com/endojs/endo/), named \\logseq____&quot;EndoZipBase64\\logseq____&quot;, in which the \\logseq____&quot;very large string\\logseq____&quot; is a base64-encoded Zip file, which contains one component for the compartment map, plus components for each of the modules it includes.logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[102,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[102,logseq____&quot;^Flogseq____&quot;,109,536870919]],[logseq____&quot;^15logseq____&quot;,[102,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[102,logseq____&quot;^Vlogseq____&quot;,67,536870919]],[logseq____&quot;^15logseq____&quot;,[102,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[102,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-d29b-410c-8df5-53575f23aecflogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[103,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;The swingset kernel provides tools to install, reference , and evaluate \\logseq____&quot;Code Bundles\\logseq____&quot;. Vats can be created from a bundle, and vats can pass around \\logseq____&quot;bundlecaps\\logseq____&quot; to refer to previously-installed bundles.logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[103,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[103,logseq____&quot;^Flogseq____&quot;,73,536870919]],[logseq____&quot;^15logseq____&quot;,[103,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[103,logseq____&quot;^Vlogseq____&quot;,73,536870919]],[logseq____&quot;^15logseq____&quot;,[103,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[103,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-5bf0-4b18-b4cb-337823f031e9logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[104,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;Note that the `waitForBundleCap()` method will wait (possibly forever) for the bundle ID to be installed before resolving its Promise, so the Promise will never resolve to `undefined`.logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[104,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[104,logseq____&quot;^Flogseq____&quot;,85,536870919]],[logseq____&quot;^15logseq____&quot;,[104,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[104,logseq____&quot;^Vlogseq____&quot;,85,536870919]],[logseq____&quot;^15logseq____&quot;,[104,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[104,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-cdbb-4252-8680-9f85b5305204logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[105,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;in these bundles, the entry point module exports a function named `buildRootObject`logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[105,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[105,logseq____&quot;^Flogseq____&quot;,126,536870919]],[logseq____&quot;^15logseq____&quot;,[105,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[105,logseq____&quot;^Vlogseq____&quot;,122,536870919]],[logseq____&quot;^15logseq____&quot;,[105,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[105,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-636b-49d5-888a-0220369bcf63logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[106,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;The kvStore has a subset of the key space reserved for holding bundles (mapping bundle ID to the JSON-encoded bundle). Another keyspace holds mapping from bundle name to bundle ID for the named bundles. These are accessed through `kernelKeeper` methods.logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[106,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[106,logseq____&quot;^Flogseq____&quot;,124,536870919]],[logseq____&quot;^15logseq____&quot;,[106,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[106,logseq____&quot;^Vlogseq____&quot;,124,536870919]],[logseq____&quot;^15logseq____&quot;,[106,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[106,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-1a06-4990-b1bf-b14dc4386168logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[107,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;in these bundles, the entry point module exports a function named `buildRootObject`logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[107,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[107,logseq____&quot;^Flogseq____&quot;,59,536870919]],[logseq____&quot;^15logseq____&quot;,[107,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[107,logseq____&quot;^Vlogseq____&quot;,93,536870919]],[logseq____&quot;^15logseq____&quot;,[107,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[107,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-5109-4faf-b3af-fd1e608f7467logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[108,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;The swingset kernel maintains a \\logseq____&quot;bundle table\\logseq____&quot; in the kernel database. Bundles can be installed here, indexed by their bundle ID, and retrieved for various purposes:logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[108,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[108,logseq____&quot;^Flogseq____&quot;,93,536870919]],[logseq____&quot;^15logseq____&quot;,[108,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[108,logseq____&quot;^Vlogseq____&quot;,93,536870919]],[logseq____&quot;^15logseq____&quot;,[108,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[108,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-5d07-4e44-b258-5194b5c89911logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[109,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;If you point at a single \\logseq____&quot;entry point\\logseq____&quot; module, and chase down all the `import` statements, youlogseq____&apos;ll find some other set of module files. Following the transitive `import` statements leads to a collection of modules and a linkage map which remembers how they are wired together.logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[109,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[109,logseq____&quot;^Flogseq____&quot;,128,536870919]],[logseq____&quot;^15logseq____&quot;,[109,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[109,logseq____&quot;^Vlogseq____&quot;,67,536870919]],[logseq____&quot;^15logseq____&quot;,[109,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[109,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-b757-4920-b726-7733bd6e621flogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[110,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;## Using Bundlecapslogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[110,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[110,logseq____&quot;^Flogseq____&quot;,36,536870919]],[logseq____&quot;^15logseq____&quot;,[110,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[110,logseq____&quot;^Vlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[110,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[110,logseq____&quot;^?logseq____&quot;,[logseq____&quot;^ logseq____&quot;,logseq____&quot;^17logseq____&quot;,2],536870919]],[logseq____&quot;^15logseq____&quot;,[110,logseq____&quot;^Jlogseq____&quot;,[],536870919]],[logseq____&quot;^15logseq____&quot;,[110,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-00b6-4149-8d0e-3537c94cb154logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[111,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;We define the \\logseq____&quot;bundle ID\\logseq____&quot; as a hash of the bundlelogseq____&apos;s compartment map file, specifically the fixed string `b1-` followed by the lowercase hex encoding of the SHA512 hash of the compartment map file. The compartment map includes hashes of all the modules included in the bundle, and the validation process ensures that the bundle contains exactly the expected set of modules. So the bundle ID is a strong identifier of the contents of the bundle, which is not sensitive to the order of the zipfile contents.logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[111,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[111,logseq____&quot;^Flogseq____&quot;,46,536870919]],[logseq____&quot;^15logseq____&quot;,[111,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[111,logseq____&quot;^Vlogseq____&quot;,46,536870919]],[logseq____&quot;^15logseq____&quot;,[111,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[111,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-2781-45ea-ad22-3b77f0d8153dlogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[112,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;==A \\logseq____&quot;code bundle\\logseq____&quot; is a data structure that captures the contents of these modules and the linkage map (called a \\logseq____&quot;compartment map\\logseq____&quot;).== Bundles are JSON-serializable objects, with one mandatory string property named `moduleFormat`, and other properties that depend on the format. Typically there is exactly one other property, and its value is a very large string (1-2 MB is common). Our bundles use a format defined by [Endo](https://github.com/endojs/endo/), named \\logseq____&quot;EndoZipBase64\\logseq____&quot;, in which the \\logseq____&quot;very large string\\logseq____&quot; is a base64-encoded Zip file, which contains one component for the compartment map, plus components for each of the modules it includes.logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[112,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[112,logseq____&quot;^Flogseq____&quot;,74,536870919]],[logseq____&quot;^15logseq____&quot;,[112,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[112,logseq____&quot;^Vlogseq____&quot;,42,536870919]],[logseq____&quot;^15logseq____&quot;,[112,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[112,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-3c73-46c0-b877-6aeaf52b3b04logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[113,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;~`D(bundleCap).getBundleID() -logseq____&gt; string`: to get the bundle IDlogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[113,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[113,logseq____&quot;^Flogseq____&quot;,41,536870919]],[logseq____&quot;^15logseq____&quot;,[113,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[113,logseq____&quot;^Vlogseq____&quot;,41,536870919]],[logseq____&quot;^15logseq____&quot;,[113,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[113,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-a34e-4f80-a883-a025b9b52c0dlogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[114,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;the liveslots bundle ID is recorded separately for each vat, so liveslots can be upgraded (for new vats) without affecting the behavior of existing oneslogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[114,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[114,logseq____&quot;^Flogseq____&quot;,39,536870919]],[logseq____&quot;^15logseq____&quot;,[114,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[114,logseq____&quot;^Vlogseq____&quot;,122,536870919]],[logseq____&quot;^15logseq____&quot;,[114,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[114,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-ba19-4fdc-9d00-d893ef05e529logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[115,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;~`D(bundleCap).getBundle() -logseq____&gt; bundle object`: if you really need the full bundle, i.e. for `importBundle()`logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[115,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[115,logseq____&quot;^Flogseq____&quot;,53,536870919]],[logseq____&quot;^15logseq____&quot;,[115,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[115,logseq____&quot;^Vlogseq____&quot;,72,536870919]],[logseq____&quot;^15logseq____&quot;,[115,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[115,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-a35b-4e30-8747-c8c2ca4a8985logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[116,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;the bundlecap can be used with `vatAdminService~.createVat()` to make a new dynamic vatlogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[116,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[116,logseq____&quot;^Flogseq____&quot;,84,536870919]],[logseq____&quot;^15logseq____&quot;,[116,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[116,logseq____&quot;^Vlogseq____&quot;,93,536870919]],[logseq____&quot;^15logseq____&quot;,[116,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[116,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-9ab3-46ef-b281-05d392eb41a0logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[117,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;But once a bundlecap is obtained, the corresponding bundle is guaranteed to be available. We do not yet have GC for bundles, but once we do, each copy of the bundlecap will establish a reference count. As long as any bundlecap is still held, the bundle will be held too. Bundles will be deleted at some point after the last bundlecap is gone. (We need a story for what keeps the bundle alive between the external `controller.validateAndInstallBundle()` and some vat getting a bundlecap, but that interval is not expected to be very long, so we might just use explicit GC actions that we donlogseq____&apos;t run very often).logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[117,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[117,logseq____&quot;^Flogseq____&quot;,142,536870919]],[logseq____&quot;^15logseq____&quot;,[117,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[117,logseq____&quot;^Vlogseq____&quot;,79,536870919]],[logseq____&quot;^15logseq____&quot;,[117,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[117,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-2980-4f04-b857-ef618101865dlogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[118,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;A future version of this interface will expose enough information to install individual modules first, and then \\logseq____&quot;install\\logseq____&quot; a bundle from just the compartment map contents (after checking that all the required modules are already present).logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[118,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[118,logseq____&quot;^Flogseq____&quot;,87,536870919]],[logseq____&quot;^15logseq____&quot;,[118,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[118,logseq____&quot;^Vlogseq____&quot;,123,536870919]],[logseq____&quot;^15logseq____&quot;,[118,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[118,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-98e2-4b88-b022-0c119fafb983logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[119,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;~`E(vatAdminService).getNamedBundleCap(name) -logseq____&gt; Promiselogseq____&lt;BundleCaplogseq____&gt;` (rejects if not registered)logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[119,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[119,logseq____&quot;^Flogseq____&quot;,34,536870919]],[logseq____&quot;^15logseq____&quot;,[119,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[119,logseq____&quot;^Vlogseq____&quot;,110,536870919]],[logseq____&quot;^15logseq____&quot;,[119,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[119,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-d785-42d2-a5ea-1d72150694a7logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[120,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;## Determinismlogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[120,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[120,logseq____&quot;^Flogseq____&quot;,138,536870919]],[logseq____&quot;^15logseq____&quot;,[120,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[120,logseq____&quot;^Vlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[120,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[120,logseq____&quot;^?logseq____&quot;,[logseq____&quot;^ logseq____&quot;,logseq____&quot;^17logseq____&quot;,2],536870919]],[logseq____&quot;^15logseq____&quot;,[120,logseq____&quot;^Jlogseq____&quot;,[],536870919]],[logseq____&quot;^15logseq____&quot;,[120,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-5cf1-4e7d-9f33-ef2aa96389e9logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[121,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;~`controller.validateAndInstallBundle(bundle, optionalAllegedBundleID)` performs validity checks, installs the bundle, and returns the computed bundle ID. It uses `kernel.installBundle(bundleID, bundle)` internally, which uses uses `kernelKeeper` to store the bundle, and does not perform validation.logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[121,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[121,logseq____&quot;^Flogseq____&quot;,69,536870919]],[logseq____&quot;^15logseq____&quot;,[121,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[121,logseq____&quot;^Vlogseq____&quot;,140,536870919]],[logseq____&quot;^15logseq____&quot;,[121,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[121,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-45aa-4837-a617-c30d5fbc6122logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[122,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;## How Swingset Uses Bundleslogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[122,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[122,logseq____&quot;^Flogseq____&quot;,129,536870919]],[logseq____&quot;^15logseq____&quot;,[122,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[122,logseq____&quot;^Vlogseq____&quot;,76,536870919]],[logseq____&quot;^15logseq____&quot;,[122,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[122,logseq____&quot;^?logseq____&quot;,[logseq____&quot;^ logseq____&quot;,logseq____&quot;^17logseq____&quot;,2],536870919]],[logseq____&quot;^15logseq____&quot;,[122,logseq____&quot;^Jlogseq____&quot;,[],536870919]],[logseq____&quot;^15logseq____&quot;,[122,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-9138-4434-a96b-534d0c845249logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[123,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;## Bundle Installation at Runtimelogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[123,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[123,logseq____&quot;^Flogseq____&quot;,66,536870919]],[logseq____&quot;^15logseq____&quot;,[123,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[123,logseq____&quot;^Vlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[123,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[123,logseq____&quot;^?logseq____&quot;,[logseq____&quot;^ logseq____&quot;,logseq____&quot;^17logseq____&quot;,2],536870919]],[logseq____&quot;^15logseq____&quot;,[123,logseq____&quot;^Jlogseq____&quot;,[],536870919]],[logseq____&quot;^15logseq____&quot;,[123,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-d3e5-473f-96ea-7e39292e18c9logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[124,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;## Kernel Internalslogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[124,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[124,logseq____&quot;^Flogseq____&quot;,110,536870919]],[logseq____&quot;^15logseq____&quot;,[124,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[124,logseq____&quot;^Vlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[124,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[124,logseq____&quot;^?logseq____&quot;,[logseq____&quot;^ logseq____&quot;,logseq____&quot;^17logseq____&quot;,2],536870919]],[logseq____&quot;^15logseq____&quot;,[124,logseq____&quot;^Jlogseq____&quot;,[],536870919]],[logseq____&quot;^15logseq____&quot;,[124,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-5bac-4131-b3e7-00e6788dcb9dlogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[125,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;We write source code in one or more files named \\logseq____&quot;modules\\logseq____&quot;, like `foo.js`. These modules will export some number of symbols (functions, etc), and can import symbols from other modules. These modules are organized into \\logseq____&quot;packages\\logseq____&quot;.logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[125,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[125,logseq____&quot;^Flogseq____&quot;,67,536870919]],[logseq____&quot;^15logseq____&quot;,[125,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[125,logseq____&quot;^Vlogseq____&quot;,67,536870919]],[logseq____&quot;^15logseq____&quot;,[125,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[125,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-a2b6-4252-af6e-4280e6a6045elogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[126,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;* all swingset vats, both static and dynamic, start from a bundlelogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[126,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[126,logseq____&quot;^Flogseq____&quot;,89,536870919]],[logseq____&quot;^15logseq____&quot;,[126,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[126,logseq____&quot;^Vlogseq____&quot;,122,536870919]],[logseq____&quot;^15logseq____&quot;,[126,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[126,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-21c5-491d-a027-858ffc0f774flogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[127,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;Bundles are interesting because they can be serialized and sent to a remote system. They can be saved in a database and instantiated (evaluated/imported) later, possibly multiple times.logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[127,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[127,logseq____&quot;^Flogseq____&quot;,81,536870919]],[logseq____&quot;^15logseq____&quot;,[127,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[127,logseq____&quot;^Vlogseq____&quot;,67,536870919]],[logseq____&quot;^15logseq____&quot;,[127,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[127,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-2870-4fd1-abf0-dc1a95a79582logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[128,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;In a given workspace (e.g. a Git checkout / working tree), you will have a hierarchy of `node_modules/` directories which contain the packages and modules that can be imported. So when `foo.js` says `import { x } from logseq____&apos;../bar.jslogseq____&apos;`, it will get code from a neighboring file, and when it says `import { y } from logseq____&apos;otherpackagelogseq____&apos;`, it will get code from somewhere in the `node_modules` directory.logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[128,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[128,logseq____&quot;^Flogseq____&quot;,125,536870919]],[logseq____&quot;^15logseq____&quot;,[128,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[128,logseq____&quot;^Vlogseq____&quot;,67,536870919]],[logseq____&quot;^15logseq____&quot;,[128,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[128,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-5291-4115-9111-4e17baa63d4flogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[129,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;==A \\logseq____&quot;bundlecap\\logseq____&quot; is an object (specifically a swingset \\logseq____&quot;device node\\logseq____&quot;) which identifies a specific installed bundle==. Bundlecaps only exist within swingset vats. Each bundlecap knows the bundle ID to which it refers. There is at most one bundlecap per bundle ID. ==It is not possible to make a bundlecap for a bundle that is not yet installed into the enclosing kernel, and holding a bundlecap guarantees that the bundle will be available== (bundles may be GCed, but the bundlecap holds a reference that inhibits collection).logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[129,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[129,logseq____&quot;^Flogseq____&quot;,76,536870919]],[logseq____&quot;^15logseq____&quot;,[129,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[129,logseq____&quot;^Vlogseq____&quot;,76,536870919]],[logseq____&quot;^15logseq____&quot;,[129,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[129,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-2699-4d08-b15c-c0d299d437falogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[130,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;the bundlecap can be used with `vatAdminService~.createVat()` to make a new dynamic vatlogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[130,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[130,logseq____&quot;^Flogseq____&quot;,70,536870919]],[logseq____&quot;^15logseq____&quot;,[130,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[130,logseq____&quot;^Vlogseq____&quot;,122,536870919]],[logseq____&quot;^15logseq____&quot;,[130,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[130,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-0d14-4ab1-9225-a48843407bb9logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[131,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;~`E(vatAdminService).createVat(bundleCap)`: create a new dynamic vat from the bundlelogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[131,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[131,logseq____&quot;^Flogseq____&quot;,45,536870919]],[logseq____&quot;^15logseq____&quot;,[131,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[131,logseq____&quot;^Vlogseq____&quot;,41,536870919]],[logseq____&quot;^15logseq____&quot;,[131,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[131,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-447c-4c0a-a9e1-a49f31d6a49clogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[132,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;this could also be used as part of an in-vat upgrade process, to load new behaviorlogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[132,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[132,logseq____&quot;^Flogseq____&quot;,83,536870919]],[logseq____&quot;^15logseq____&quot;,[132,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[132,logseq____&quot;^Vlogseq____&quot;,93,536870919]],[logseq____&quot;^15logseq____&quot;,[132,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[132,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-c013-40b3-8a08-ba86b4cf6554logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[133,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;==Using bundlecaps is much more efficient than passing the entire (large) bundle object through messages.==logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[133,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[133,logseq____&quot;^Flogseq____&quot;,103,536870919]],[logseq____&quot;^15logseq____&quot;,[133,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[133,logseq____&quot;^Vlogseq____&quot;,73,536870919]],[logseq____&quot;^15logseq____&quot;,[133,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[133,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-d317-40bc-9934-cfc7803f031clogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[134,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;When defining a static vat in the Swingset `config.vats` object, the filename provided as `sourceSpec` is turned into a bundle, the bundle is installed into the bundle table, and resulting bundle ID is stored in the vatlogseq____&apos;s database record. When the static vat is launched, the DB record provides the bundle ID, and the bundle is loaded and evaluated in a new vat worker.logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[134,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[134,logseq____&quot;^Flogseq____&quot;,58,536870919]],[logseq____&quot;^15logseq____&quot;,[134,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[134,logseq____&quot;^Vlogseq____&quot;,58,536870919]],[logseq____&quot;^15logseq____&quot;,[134,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[134,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-1b81-4395-b404-1eb0e4834f84logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[135,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;~`controller.validateAndInstallBundle(bundle, optionalAllegedBundleID)` performs validity checks, installs the bundle, and returns the computed bundle ID. It uses `kernel.installBundle(bundleID, bundle)` internally, which uses uses `kernelKeeper` to store the bundle, and does not perform validation.logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[135,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[135,logseq____&quot;^Flogseq____&quot;,86,536870919]],[logseq____&quot;^15logseq____&quot;,[135,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[135,logseq____&quot;^Vlogseq____&quot;,124,536870919]],[logseq____&quot;^15logseq____&quot;,[135,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[135,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-f5c3-4f96-be79-57c884ceaaf1logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[136,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;~`E(vatAdminService).getNamedBundleCap(name) -logseq____&gt; Promiselogseq____&lt;BundleCaplogseq____&gt;` (rejects if not registered)logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[136,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[136,logseq____&quot;^Flogseq____&quot;,31,536870919]],[logseq____&quot;^15logseq____&quot;,[136,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[136,logseq____&quot;^Vlogseq____&quot;,98,536870919]],[logseq____&quot;^15logseq____&quot;,[136,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[136,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-dd24-4722-952c-b2893c4d5ccblogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[137,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;We write source code in one or more files named \\logseq____&quot;modules\\logseq____&quot;, like `foo.js`. These modules will export some number of symbols (functions, etc), and can import symbols from other modules. These modules are organized into \\logseq____&quot;packages\\logseq____&quot;.logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[137,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[137,logseq____&quot;^Flogseq____&quot;,42,536870919]],[logseq____&quot;^15logseq____&quot;,[137,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[137,logseq____&quot;^Vlogseq____&quot;,42,536870919]],[logseq____&quot;^15logseq____&quot;,[137,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[137,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-e61e-40ab-8efd-d50d5bb6ac42logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[138,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[138,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[138,logseq____&quot;^Flogseq____&quot;,140,536870919]],[logseq____&quot;^15logseq____&quot;,[138,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[138,logseq____&quot;^Vlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[138,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[138,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-db2e-496b-a59a-cd0bf44cbab3logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[139,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;userspace can use `D(bundleCap).getBundle()` to fetch the bundle itself, for use with an `importBundle()` that does not create an entire new vatlogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[139,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[139,logseq____&quot;^Flogseq____&quot;,116,536870919]],[logseq____&quot;^15logseq____&quot;,[139,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[139,logseq____&quot;^Vlogseq____&quot;,93,536870919]],[logseq____&quot;^15logseq____&quot;,[139,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[139,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-6247-46f9-a532-fe00eaff278dlogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[140,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;## Kernel Internalslogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[140,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[140,logseq____&quot;^Flogseq____&quot;,98,536870919]],[logseq____&quot;^15logseq____&quot;,[140,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[140,logseq____&quot;^Vlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[140,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[140,logseq____&quot;^?logseq____&quot;,[logseq____&quot;^ logseq____&quot;,logseq____&quot;^17logseq____&quot;,2],536870919]],[logseq____&quot;^15logseq____&quot;,[140,logseq____&quot;^Jlogseq____&quot;,[],536870919]],[logseq____&quot;^15logseq____&quot;,[140,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-740d-489a-8cd5-23191f26c079logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[141,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;the kernel source code itself is stored in a bundle, to make it easier to switch from one version of the kernel to another at a pre-determined timelogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[141,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[141,logseq____&quot;^Flogseq____&quot;,100,536870919]],[logseq____&quot;^15logseq____&quot;,[141,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[141,logseq____&quot;^Vlogseq____&quot;,93,536870919]],[logseq____&quot;^15logseq____&quot;,[141,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[141,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-f7df-4ea7-928b-2fe749bd959blogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[142,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;Bundle installation is a transactional event: it must happen, and be committed, before the bundle is available. `E(vatAdminService).getBundleCap(bundleID)` will fail (consistently) if the bundle was not already installed. Host applications (like a chain) should perform `validateAndInstallBundle()` from within a transaction, so all validators maintain consensus about whether the bundle is installed or not.logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[142,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[142,logseq____&quot;^Flogseq____&quot;,79,536870919]],[logseq____&quot;^15logseq____&quot;,[142,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[142,logseq____&quot;^Vlogseq____&quot;,79,536870919]],[logseq____&quot;^15logseq____&quot;,[142,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[142,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-c60c-4f3e-b391-6cbb8859663clogseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[143,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;Once the kernel is up and running, new bundles can be installed with the `controller.validateAndInstallBundle()` interface. This accepts a bundle and an optional alleged bundle ID. It performs validity checks: if the ID is provided but does not match the compartment map, or if (TODO) the bundle contents do not match the compartment map, or if (TODO) the contents do not parse as JavaScript modules, then it will throw. If everything looks good, it will install the bundle into the table and return the computed bundle ID.logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[143,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[143,logseq____&quot;^Flogseq____&quot;,36,536870919]],[logseq____&quot;^15logseq____&quot;,[143,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[143,logseq____&quot;^Vlogseq____&quot;,36,536870919]],[logseq____&quot;^15logseq____&quot;,[143,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[143,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-6f81-4f54-9aff-a44374b1c1a9logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[144,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;~`E(vatAdminService).getBundleIDByName(name) -logseq____&gt; Promiselogseq____&lt;stringlogseq____&gt;` (rejects if not registered)logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[144,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[144,logseq____&quot;^Flogseq____&quot;,136,536870919]],[logseq____&quot;^15logseq____&quot;,[144,logseq____&quot;^Xlogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[144,logseq____&quot;^Vlogseq____&quot;,98,536870919]],[logseq____&quot;^15logseq____&quot;,[144,logseq____&quot;^Ulogseq____&quot;,28,536870919]],[logseq____&quot;^15logseq____&quot;,[144,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-492e-423b-bb11-66c69dab6972logseq____&quot;,536870919]],[logseq____&quot;^15logseq____&quot;,[146,logseq____&quot;^Klogseq____&quot;,1725436529858,536870920]],[logseq____&quot;^15logseq____&quot;,[146,logseq____&quot;^@logseq____&quot;,false,536870920]],[logseq____&quot;^15logseq____&quot;,[146,logseq____&quot;^Ylogseq____&quot;,logseq____&quot;the run policylogseq____&quot;,536870920]],[logseq____&quot;^15logseq____&quot;,[146,logseq____&quot;^11logseq____&quot;,logseq____&quot;The Run Policylogseq____&quot;,536870920]],[logseq____&quot;^15logseq____&quot;,[146,logseq____&quot;^Blogseq____&quot;,1725436529858,536870920]],[logseq____&quot;^15logseq____&quot;,[146,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-4a0a-4b36-8d30-4b648cfa2e2clogseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[147,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;### Swingset VMlogseq____&quot;,536870920]],[logseq____&quot;^15logseq____&quot;,[147,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870920]],[logseq____&quot;^15logseq____&quot;,[147,logseq____&quot;^Flogseq____&quot;,20,536870920]],[logseq____&quot;^15logseq____&quot;,[147,logseq____&quot;^Xlogseq____&quot;,20,536870920]],[logseq____&quot;^15logseq____&quot;,[147,logseq____&quot;^Vlogseq____&quot;,20,536870920]],[logseq____&quot;^15logseq____&quot;,[147,logseq____&quot;^Ulogseq____&quot;,20,536870920]],[logseq____&quot;^15logseq____&quot;,[147,logseq____&quot;^?logseq____&quot;,[logseq____&quot;^ logseq____&quot;,logseq____&quot;^17logseq____&quot;,3],536870920]],[logseq____&quot;^15logseq____&quot;,[147,logseq____&quot;^Jlogseq____&quot;,[],536870920]],[logseq____&quot;^15logseq____&quot;,[147,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-40ec-4b59-917c-0cf17ff8661dlogseq____&quot;,536870920]],[logseq____&quot;^15logseq____&quot;,[148,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;[[Code Bundles]]logseq____&quot;,536870920]],[logseq____&quot;^15logseq____&quot;,[148,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870920]],[logseq____&quot;^15logseq____&quot;,[148,logseq____&quot;^Flogseq____&quot;,147,536870920]],[logseq____&quot;^15logseq____&quot;,[148,logseq____&quot;^Xlogseq____&quot;,20,536870920]],[logseq____&quot;^15logseq____&quot;,[148,logseq____&quot;^Vlogseq____&quot;,147,536870920]],[logseq____&quot;^15logseq____&quot;,[148,logseq____&quot;^Ulogseq____&quot;,20,536870920]],[logseq____&quot;^15logseq____&quot;,[148,logseq____&quot;^Ulogseq____&quot;,28,536870920]],[logseq____&quot;^15logseq____&quot;,[148,logseq____&quot;^Hlogseq____&quot;,28,536870920]],[logseq____&quot;^15logseq____&quot;,[148,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-096d-4bf4-9d75-5ac2f3bda652logseq____&quot;,536870920]],[logseq____&quot;^15logseq____&quot;,[149,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;[[The Run Policy]]logseq____&quot;,536870920]],[logseq____&quot;^15logseq____&quot;,[149,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870920]],[logseq____&quot;^15logseq____&quot;,[149,logseq____&quot;^Flogseq____&quot;,148,536870920]],[logseq____&quot;^15logseq____&quot;,[149,logseq____&quot;^Xlogseq____&quot;,20,536870920]],[logseq____&quot;^15logseq____&quot;,[149,logseq____&quot;^Vlogseq____&quot;,147,536870920]],[logseq____&quot;^15logseq____&quot;,[149,logseq____&quot;^Ulogseq____&quot;,20,536870920]],[logseq____&quot;^15logseq____&quot;,[149,logseq____&quot;^Ulogseq____&quot;,146,536870920]],[logseq____&quot;^15logseq____&quot;,[149,logseq____&quot;^Hlogseq____&quot;,146,536870920]],[logseq____&quot;^15logseq____&quot;,[149,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-b9df-473f-80c4-a0451c33e311logseq____&quot;,536870920]],[logseq____&quot;^15logseq____&quot;,[150,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;logseq____&quot;,536870920]],[logseq____&quot;^15logseq____&quot;,[150,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870920]],[logseq____&quot;^15logseq____&quot;,[150,logseq____&quot;^Flogseq____&quot;,149,536870920]],[logseq____&quot;^15logseq____&quot;,[150,logseq____&quot;^Xlogseq____&quot;,20,536870920]],[logseq____&quot;^15logseq____&quot;,[150,logseq____&quot;^Vlogseq____&quot;,147,536870920]],[logseq____&quot;^15logseq____&quot;,[150,logseq____&quot;^Ulogseq____&quot;,20,536870920]],[logseq____&quot;^15logseq____&quot;,[150,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-5bd9-4f4c-b88e-ca42459e4b87logseq____&quot;,536870920]],[logseq____&quot;^15logseq____&quot;,[151,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;logseq____&quot;,536870920]],[logseq____&quot;^15logseq____&quot;,[151,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870920]],[logseq____&quot;^15logseq____&quot;,[151,logseq____&quot;^Flogseq____&quot;,147,536870920]],[logseq____&quot;^15logseq____&quot;,[151,logseq____&quot;^Xlogseq____&quot;,20,536870920]],[logseq____&quot;^15logseq____&quot;,[151,logseq____&quot;^Vlogseq____&quot;,20,536870920]],[logseq____&quot;^15logseq____&quot;,[151,logseq____&quot;^Ulogseq____&quot;,20,536870920]],[logseq____&quot;^15logseq____&quot;,[151,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-0916-498d-aa03-d03d5a47f594logseq____&quot;,536870920]],[logseq____&quot;^15logseq____&quot;,[153,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;## Non-Consensus Wallclock Limitslogseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[153,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[153,logseq____&quot;^Flogseq____&quot;,155,536870921]],[logseq____&quot;^15logseq____&quot;,[153,logseq____&quot;^Xlogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[153,logseq____&quot;^Vlogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[153,logseq____&quot;^Ulogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[153,logseq____&quot;^?logseq____&quot;,[logseq____&quot;^ logseq____&quot;,logseq____&quot;^17logseq____&quot;,2],536870921]],[logseq____&quot;^15logseq____&quot;,[153,logseq____&quot;^Jlogseq____&quot;,[],536870921]],[logseq____&quot;^15logseq____&quot;,[153,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-9521-4231-aac7-8ada1c261e63logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[154,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;# The Run Policylogseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[154,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[154,logseq____&quot;^Flogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[154,logseq____&quot;^Xlogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[154,logseq____&quot;^Vlogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[154,logseq____&quot;^Ulogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[154,logseq____&quot;^?logseq____&quot;,[logseq____&quot;^ logseq____&quot;,logseq____&quot;^17logseq____&quot;,1],536870921]],[logseq____&quot;^15logseq____&quot;,[154,logseq____&quot;^Jlogseq____&quot;,[],536870921]],[logseq____&quot;^15logseq____&quot;,[154,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-fa43-44bc-8115-67072ec84305logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[155,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;## Typical Run Policieslogseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[155,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[155,logseq____&quot;^Flogseq____&quot;,180,536870921]],[logseq____&quot;^15logseq____&quot;,[155,logseq____&quot;^Xlogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[155,logseq____&quot;^Vlogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[155,logseq____&quot;^Ulogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[155,logseq____&quot;^?logseq____&quot;,[logseq____&quot;^ logseq____&quot;,logseq____&quot;^17logseq____&quot;,2],536870921]],[logseq____&quot;^15logseq____&quot;,[155,logseq____&quot;^Jlogseq____&quot;,[],536870921]],[logseq____&quot;^15logseq____&quot;,[155,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-c17b-43c0-8716-104f43201b35logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[156,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;A more sophisticated one would count computrons. Suppose that experiments suggest that one million computrons take about 5 seconds to execute. The policy would look like:logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[156,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[156,logseq____&quot;^Flogseq____&quot;,167,536870921]],[logseq____&quot;^15logseq____&quot;,[156,logseq____&quot;^Xlogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[156,logseq____&quot;^Vlogseq____&quot;,155,536870921]],[logseq____&quot;^15logseq____&quot;,[156,logseq____&quot;^Ulogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[156,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-4530-4d76-a073-f55ea16c7dd9logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[157,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;~`policy.crankComplete({ computrons })`logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[157,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[157,logseq____&quot;^Flogseq____&quot;,175,536870921]],[logseq____&quot;^15logseq____&quot;,[157,logseq____&quot;^Xlogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[157,logseq____&quot;^Vlogseq____&quot;,171,536870921]],[logseq____&quot;^15logseq____&quot;,[157,logseq____&quot;^Ulogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[157,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-dd6d-4ceb-9696-851647f091f9logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[158,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;All methods should return `true` if the kernel should keep running, or `false` if it should stop.logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[158,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[158,logseq____&quot;^Flogseq____&quot;,171,536870921]],[logseq____&quot;^15logseq____&quot;,[158,logseq____&quot;^Xlogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[158,logseq____&quot;^Vlogseq____&quot;,184,536870921]],[logseq____&quot;^15logseq____&quot;,[158,logseq____&quot;^Ulogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[158,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-e7f8-490c-9aa9-0563031647c5logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[159,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;To impose this limit, the host application has two choices. The first is to call `controller.step()` many times, until the limit is reached. Each invocation performs one delivery to one vat, and returns `true` if there is more work left on the run-queue, or `false` if the queue is empty. Applications could use this method if they want to impose a wallclock limit on the block (keep calling `step()` until 5 seconds have passed or it returns `false`).logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[159,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[159,logseq____&quot;^Flogseq____&quot;,192,536870921]],[logseq____&quot;^15logseq____&quot;,[159,logseq____&quot;^Xlogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[159,logseq____&quot;^Vlogseq____&quot;,154,536870921]],[logseq____&quot;^15logseq____&quot;,[159,logseq____&quot;^Ulogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[159,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-cab5-402f-bf7b-1478bffa100flogseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[160,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;The SwingSet kernel maintains a queue of pending operations to execute: mostly deliveries to vats and promise resolution notifications. This queue may be sizable, and each operation may provoke more work to be added to the list.logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[160,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[160,logseq____&quot;^Flogseq____&quot;,154,536870921]],[logseq____&quot;^15logseq____&quot;,[160,logseq____&quot;^Xlogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[160,logseq____&quot;^Vlogseq____&quot;,154,536870921]],[logseq____&quot;^15logseq____&quot;,[160,logseq____&quot;^Ulogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[160,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-9d24-4aac-ac2a-fab618697d5blogseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[161,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;message deliveries to vats (provoked by `syscall.send`, delivered as `dispatch.deliver`)logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[161,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[161,logseq____&quot;^Flogseq____&quot;,162,536870921]],[logseq____&quot;^15logseq____&quot;,[161,logseq____&quot;^Xlogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[161,logseq____&quot;^Vlogseq____&quot;,162,536870921]],[logseq____&quot;^15logseq____&quot;,[161,logseq____&quot;^Ulogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[161,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-1754-4e72-b645-9e0137d63bc1logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[162,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;If the GC Action queue is entirely empty, the kernel will look for regular work to do. **This consists of the following event types**:logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[162,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[162,logseq____&quot;^Flogseq____&quot;,165,536870921]],[logseq____&quot;^15logseq____&quot;,[162,logseq____&quot;^Xlogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[162,logseq____&quot;^Vlogseq____&quot;,182,536870921]],[logseq____&quot;^15logseq____&quot;,[162,logseq____&quot;^Ulogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[162,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-4570-4a93-909a-e588880e2a32logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[163,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;The kernel knows nothing of time, because the kernel is specifically deterministic. If you want to use wallclock time (which is inherently non-deterministic across the separate nodes of a consensus machine), the run policy is responsible for bringing its own source of nondeterminism.logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[163,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[163,logseq____&quot;^Flogseq____&quot;,176,536870921]],[logseq____&quot;^15logseq____&quot;,[163,logseq____&quot;^Xlogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[163,logseq____&quot;^Vlogseq____&quot;,153,536870921]],[logseq____&quot;^15logseq____&quot;,[163,logseq____&quot;^Ulogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[163,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-c5dd-48f2-97ad-6f827e3cb4c5logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[164,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;~`policy.crankFailed()`logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[164,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[164,logseq____&quot;^Flogseq____&quot;,157,536870921]],[logseq____&quot;^15logseq____&quot;,[164,logseq____&quot;^Xlogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[164,logseq____&quot;^Vlogseq____&quot;,171,536870921]],[logseq____&quot;^15logseq____&quot;,[164,logseq____&quot;^Ulogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[164,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-a73b-4b22-a198-f40c20f73e16logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[165,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;The kernel maintains two queues. The highest priority queue contains \\logseq____&quot;GC Actions\\logseq____&quot;, which are messages to vats that indicate an object has been garbage collected and can now be freed. These are provoked by reference-counting operations that occur as a side-effect of GC syscalls, as well as vat termination events. Each GC Action counts as a \\logseq____&quot;crank\\logseq____&quot;, and is reported to the policy object. The policy may end a block while there is still GC Action work to do, in which case the kernel will pick it back up again when the next block begins.logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[165,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[165,logseq____&quot;^Flogseq____&quot;,182,536870921]],[logseq____&quot;^15logseq____&quot;,[165,logseq____&quot;^Xlogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[165,logseq____&quot;^Vlogseq____&quot;,182,536870921]],[logseq____&quot;^15logseq____&quot;,[165,logseq____&quot;^Ulogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[165,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-53c1-4b24-b6e8-571152ec8960logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[166,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;~`emptyCrank` indicates the kernel processed a queued messages which didnlogseq____&apos;t result in a delivery.logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[166,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[166,logseq____&quot;^Flogseq____&quot;,170,536870921]],[logseq____&quot;^15logseq____&quot;,[166,logseq____&quot;^Xlogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[166,logseq____&quot;^Vlogseq____&quot;,184,536870921]],[logseq____&quot;^15logseq____&quot;,[166,logseq____&quot;^Ulogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[166,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-ca11-492d-891f-9c462716fdd0logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[167,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;Note that a new policy object should be provided for each call to `run()`.logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[167,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[167,logseq____&quot;^Flogseq____&quot;,168,536870921]],[logseq____&quot;^15logseq____&quot;,[167,logseq____&quot;^Xlogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[167,logseq____&quot;^Vlogseq____&quot;,155,536870921]],[logseq____&quot;^15logseq____&quot;,[167,logseq____&quot;^Ulogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[167,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-d722-4e9d-9322-f790e8e2bebalogseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[168,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;~```jsfunction make100CrankPolicy() {\\nlet cranks = 0;\\nlet vats = 0;\\nconst policy  = harden({\\n  vatCreated() {\\n  vats += 1;\\n  return (vats logseq____&lt; 2);\\n  },\\n  crankComplete(details) {\\n  cranks += 1;\\n  return (cranks logseq____&lt; 100);\\n  },\\n  crankFailed() {\\n  cranks += 1;\\n  return (cranks logseq____&lt; 100);\\n  },\\n  emptyCrank() {\\n  return true;\\n  },\\n});\\n}\\n//and would be supplied like:\\nwhile(1) {\\n  processInboundIO();\\n  const policy = make100CrankPolicy();\\n  await controller.run(policy);\\n  await commit();\\n  processOutboundIO();\\n}\\n ```logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[168,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[168,logseq____&quot;^Flogseq____&quot;,183,536870921]],[logseq____&quot;^15logseq____&quot;,[168,logseq____&quot;^Xlogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[168,logseq____&quot;^Vlogseq____&quot;,155,536870921]],[logseq____&quot;^15logseq____&quot;,[168,logseq____&quot;^Ulogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[168,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-5d6f-44b9-b221-ab3a580f5343logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[169,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;But the more sophisticated approach is to call `controller.run(policy)`, with a \\logseq____&quot;Run Policy\\logseq____&quot; object that knows when the block should end. The policy object will get detailed information about each delivery, including the metering results (how many low-level JS engine operations were performed), and can use this to guide the block size.logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[169,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[169,logseq____&quot;^Flogseq____&quot;,159,536870921]],[logseq____&quot;^15logseq____&quot;,[169,logseq____&quot;^Xlogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[169,logseq____&quot;^Vlogseq____&quot;,154,536870921]],[logseq____&quot;^15logseq____&quot;,[169,logseq____&quot;^Ulogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[169,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-90cc-49f9-998d-b1e8c0c9ee5blogseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[170,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;~`crankFailed` indicates the vat suffered an error during crank delivery, such as a metering fault, memory allocation fault, or fatal syscall. We do not currently have a way to measure the computron usage of failed cranks (many of the error cases are signaled by the worker process exiting with a distinctive status code, which does not give it an opportunity to report back detailed metering data). The run policy should assume the worst.logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[170,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[170,logseq____&quot;^Flogseq____&quot;,174,536870921]],[logseq____&quot;^15logseq____&quot;,[170,logseq____&quot;^Xlogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[170,logseq____&quot;^Vlogseq____&quot;,184,536870921]],[logseq____&quot;^15logseq____&quot;,[170,logseq____&quot;^Ulogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[170,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-4998-42f3-80b3-7c509353223clogseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[171,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;The kernel will invoke the following methods on the policy object (so all must exist, even if theylogseq____&apos;re empty):logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[171,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[171,logseq____&quot;^Flogseq____&quot;,184,536870921]],[logseq____&quot;^15logseq____&quot;,[171,logseq____&quot;^Xlogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[171,logseq____&quot;^Vlogseq____&quot;,184,536870921]],[logseq____&quot;^15logseq____&quot;,[171,logseq____&quot;^Ulogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[171,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-20a4-4a57-a9aa-6c97bad84e7clogseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[172,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;Each message delivery and resolution notification causes (at most) one vat to execute one \\logseq____&quot;crank\\logseq____&quot; (it might not execute any crank, e.g. when a message is delivered to an unresolved promise, it just gets added to the promiselogseq____&apos;s queue). This crank gives the vat some amount of time to process the delivery, during which it may invoke any number of syscalls. The crank might cause the vat to be terminated, either because of an error, or because it took too much CPU and exceeded its Meterlogseq____&apos;s allowance. Each crank yields a \\logseq____&quot;delivery results object\\logseq____&quot;, which indicates the success or failure of the delivery.logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[172,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[172,logseq____&quot;^Flogseq____&quot;,162,536870921]],[logseq____&quot;^15logseq____&quot;,[172,logseq____&quot;^Xlogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[172,logseq____&quot;^Vlogseq____&quot;,182,536870921]],[logseq____&quot;^15logseq____&quot;,[172,logseq____&quot;^Ulogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[172,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-74da-428f-8a76-2296c30d6bd2logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[173,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;promise resolution notifications (provoked by `syscall.resolve`, delivered as `dispatch.notify`)logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[173,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[173,logseq____&quot;^Flogseq____&quot;,161,536870921]],[logseq____&quot;^15logseq____&quot;,[173,logseq____&quot;^Xlogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[173,logseq____&quot;^Vlogseq____&quot;,162,536870921]],[logseq____&quot;^15logseq____&quot;,[173,logseq____&quot;^Ulogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[173,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-d367-4286-8f50-98c90c636a31logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[174,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;The `computrons` argument may be `undefined` (e.g. if the crank was delivered to a non-`xs worker`-based vat, such as the comms vat). The policy should probably treat this as equivalent to some \\logseq____&quot;typical\\logseq____&quot; number of computrons.logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[174,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[174,logseq____&quot;^Flogseq____&quot;,158,536870921]],[logseq____&quot;^15logseq____&quot;,[174,logseq____&quot;^Xlogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[174,logseq____&quot;^Vlogseq____&quot;,184,536870921]],[logseq____&quot;^15logseq____&quot;,[174,logseq____&quot;^Ulogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[174,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-1501-4189-af0d-072bbfd9731flogseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[175,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;~`policy.vatCreated()`logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[175,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[175,logseq____&quot;^Flogseq____&quot;,171,536870921]],[logseq____&quot;^15logseq____&quot;,[175,logseq____&quot;^Xlogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[175,logseq____&quot;^Vlogseq____&quot;,171,536870921]],[logseq____&quot;^15logseq____&quot;,[175,logseq____&quot;^Ulogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[175,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-5f30-4d52-9f0a-941d40b7196blogseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[176,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;The kernel does not know (ahead of time) how long the last crank will take, so this will ensure the N-1 initial cranks take less than `seconds` time.logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[176,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[176,logseq____&quot;^Flogseq____&quot;,195,536870921]],[logseq____&quot;^15logseq____&quot;,[176,logseq____&quot;^Xlogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[176,logseq____&quot;^Vlogseq____&quot;,153,536870921]],[logseq____&quot;^15logseq____&quot;,[176,logseq____&quot;^Ulogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[176,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-d556-4df7-a0d7-8ba122b5707blogseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[177,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;If the SwingSet kernel is not being operated in consensus mode, then it is safe to use wallclock time as a block limit:logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[177,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[177,logseq____&quot;^Flogseq____&quot;,153,536870921]],[logseq____&quot;^15logseq____&quot;,[177,logseq____&quot;^Xlogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[177,logseq____&quot;^Vlogseq____&quot;,153,536870921]],[logseq____&quot;^15logseq____&quot;,[177,logseq____&quot;^Ulogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[177,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-ebf7-4e03-bc16-abb09bb60e59logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[178,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;~`vatCreated:` the size of the source bundlelogseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[178,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[178,logseq____&quot;^Flogseq____&quot;,181,536870921]],[logseq____&quot;^15logseq____&quot;,[178,logseq____&quot;^Xlogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[178,logseq____&quot;^Vlogseq____&quot;,181,536870921]],[logseq____&quot;^15logseq____&quot;,[178,logseq____&quot;^Ulogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[178,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-3953-4399-b072-13f75f1f3e59logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[179,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;~`policy.emptyCrank()`logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[179,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[179,logseq____&quot;^Flogseq____&quot;,164,536870921]],[logseq____&quot;^15logseq____&quot;,[179,logseq____&quot;^Xlogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[179,logseq____&quot;^Vlogseq____&quot;,171,536870921]],[logseq____&quot;^15logseq____&quot;,[179,logseq____&quot;^Ulogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[179,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-04bb-4545-a78b-b81b0e606d68logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[180,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;The run policy should be provided as the first argument to `controller.run()`. If omitted, the kernel defaults to `forever`, a policy that runs until the queue is empty.logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[180,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[180,logseq____&quot;^Flogseq____&quot;,184,536870921]],[logseq____&quot;^15logseq____&quot;,[180,logseq____&quot;^Xlogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[180,logseq____&quot;^Vlogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[180,logseq____&quot;^Ulogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[180,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-c8a9-47cc-afe9-30130e0fa700logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[181,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;More arguments may be added in the future, such as:logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[181,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[181,logseq____&quot;^Flogseq____&quot;,166,536870921]],[logseq____&quot;^15logseq____&quot;,[181,logseq____&quot;^Xlogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[181,logseq____&quot;^Vlogseq____&quot;,184,536870921]],[logseq____&quot;^15logseq____&quot;,[181,logseq____&quot;^Ulogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[181,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-1027-485b-bbd5-b22d205a82c7logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[182,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;## Crankslogseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[182,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[182,logseq____&quot;^Flogseq____&quot;,154,536870921]],[logseq____&quot;^15logseq____&quot;,[182,logseq____&quot;^Xlogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[182,logseq____&quot;^Vlogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[182,logseq____&quot;^Ulogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[182,logseq____&quot;^?logseq____&quot;,[logseq____&quot;^ logseq____&quot;,logseq____&quot;^17logseq____&quot;,2],536870921]],[logseq____&quot;^15logseq____&quot;,[182,logseq____&quot;^Jlogseq____&quot;,[],536870921]],[logseq____&quot;^15logseq____&quot;,[182,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-7c17-45bf-b3d7-395e83f09378logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[183,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;A basic policy might simply limit the block to 100 cranks with deliveries and two vat creations:logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[183,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[183,logseq____&quot;^Flogseq____&quot;,155,536870921]],[logseq____&quot;^15logseq____&quot;,[183,logseq____&quot;^Xlogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[183,logseq____&quot;^Vlogseq____&quot;,155,536870921]],[logseq____&quot;^15logseq____&quot;,[183,logseq____&quot;^Ulogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[183,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-b1a1-4872-836c-d96170a5743dlogseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[184,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;## Run Policylogseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[184,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[184,logseq____&quot;^Flogseq____&quot;,182,536870921]],[logseq____&quot;^15logseq____&quot;,[184,logseq____&quot;^Xlogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[184,logseq____&quot;^Vlogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[184,logseq____&quot;^Ulogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[184,logseq____&quot;^?logseq____&quot;,[logseq____&quot;^ logseq____&quot;,logseq____&quot;^17logseq____&quot;,2],536870921]],[logseq____&quot;^15logseq____&quot;,[184,logseq____&quot;^Jlogseq____&quot;,[],536870921]],[logseq____&quot;^15logseq____&quot;,[184,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-af58-4db7-a9bd-7f8fe5b560b9logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[185,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;When run in a suitable vat worker (`managerType: logseq____&apos;xs-workerlogseq____&apos;`), the delivery results also include the number of \\logseq____&quot;computrons\\logseq____&quot; consumed, as counted by the JS engine. Computrons are vaguely correlated to CPU cycles (despite being much larger) and thus some correspondence to wallclock time. A Run Policy which wishes to limit wallclock time in a consensus-base manner should pay attention to the cumulative computron count, and end the block after some experimentally-determined limit.logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[185,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[185,logseq____&quot;^Flogseq____&quot;,172,536870921]],[logseq____&quot;^15logseq____&quot;,[185,logseq____&quot;^Xlogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[185,logseq____&quot;^Vlogseq____&quot;,182,536870921]],[logseq____&quot;^15logseq____&quot;,[185,logseq____&quot;^Ulogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[185,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-6d50-4fed-a3dd-5f9a4dcadd77logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[186,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;SwingSet manages its own prioritization and scheduling for this workload, but it does not get to decide how much work should be done at a time. The host applications breaks this work up into \\logseq____&quot;blocks\\logseq____&quot;. We colloquially describe this as the \\logseq____&quot;block size\\logseq____&quot;: in the SwingSet context this refers to the number of deliveries (\\logseq____&quot;cranks\\logseq____&quot;) performed before declaring the block to be finished, rather than measuring the number of bytes in some host application consensus data structure.logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[186,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[186,logseq____&quot;^Flogseq____&quot;,160,536870921]],[logseq____&quot;^15logseq____&quot;,[186,logseq____&quot;^Xlogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[186,logseq____&quot;^Vlogseq____&quot;,154,536870921]],[logseq____&quot;^15logseq____&quot;,[186,logseq____&quot;^Ulogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[186,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-e224-4dea-82a4-9202902a887dlogseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[187,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;Vat creation also gives a single vat (the brand new one) time to run the top-level forms of its source bundle, as well as the invocation of its `buildRootObject()` method. This typically takes considerably longer than the subsequent messages, and is not currently metered.logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[187,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[187,logseq____&quot;^Flogseq____&quot;,185,536870921]],[logseq____&quot;^15logseq____&quot;,[187,logseq____&quot;^Xlogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[187,logseq____&quot;^Vlogseq____&quot;,182,536870921]],[logseq____&quot;^15logseq____&quot;,[187,logseq____&quot;^Ulogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[187,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-a6b7-44a7-95a9-82560c24741dlogseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[188,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;~`crankFailed`: the nature of the failure (we might be able to distinguish between 1: per-crank metering limit exceeded, 2: allocation limit exceed, 3: fatal syscall, 4: Meter exhausted)logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[188,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[188,logseq____&quot;^Flogseq____&quot;,189,536870921]],[logseq____&quot;^15logseq____&quot;,[188,logseq____&quot;^Xlogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[188,logseq____&quot;^Vlogseq____&quot;,181,536870921]],[logseq____&quot;^15logseq____&quot;,[188,logseq____&quot;^Ulogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[188,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-b1a6-46d9-ae26-2034585bb949logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[189,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;~`crankFailed`: the number of computrons consumed before the failurelogseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[189,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[189,logseq____&quot;^Flogseq____&quot;,193,536870921]],[logseq____&quot;^15logseq____&quot;,[189,logseq____&quot;^Xlogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[189,logseq____&quot;^Vlogseq____&quot;,181,536870921]],[logseq____&quot;^15logseq____&quot;,[189,logseq____&quot;^Ulogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[189,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-b151-40ae-9196-9bbeb2dbe368logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[190,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;~`crankComplete`: the number of syscalls that were madelogseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[190,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[190,logseq____&quot;^Flogseq____&quot;,178,536870921]],[logseq____&quot;^15logseq____&quot;,[190,logseq____&quot;^Xlogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[190,logseq____&quot;^Vlogseq____&quot;,181,536870921]],[logseq____&quot;^15logseq____&quot;,[190,logseq____&quot;^Ulogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[190,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-9e74-46c3-adbe-a9442471f3aalogseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[191,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;vat creationlogseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[191,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[191,logseq____&quot;^Flogseq____&quot;,173,536870921]],[logseq____&quot;^15logseq____&quot;,[191,logseq____&quot;^Xlogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[191,logseq____&quot;^Vlogseq____&quot;,162,536870921]],[logseq____&quot;^15logseq____&quot;,[191,logseq____&quot;^Ulogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[191,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-590a-4e57-99f1-c9015edc798alogseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[192,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;The host is responsible for committing the SwingSet state to durable storage (i.e. `swingstore.commit()`) at the end of a block. Outbound messages are embargoed until after this commit point, to prevent \\logseq____&quot;hangover inconsistency\\logseq____&quot; from revealing state that might still get unwound. Large block sizes are generally more efficient, however 1: they increase latency, because outbound reply messages cannot be delivered until the end of the block, and 2: they increase the likelihood of losing progress because of a crash or other interrupt during the block. Depending upon the application, it may be appropriate to limit blocks to 5-10 seconds of computation.logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[192,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[192,logseq____&quot;^Flogseq____&quot;,186,536870921]],[logseq____&quot;^15logseq____&quot;,[192,logseq____&quot;^Xlogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[192,logseq____&quot;^Vlogseq____&quot;,154,536870921]],[logseq____&quot;^15logseq____&quot;,[192,logseq____&quot;^Ulogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[192,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-e6e2-4dcd-be7e-7f609092d5d7logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[193,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;* (the first message delivered to each ZCF contract vat contains a very large contract source bundle, and takes considerable time to execute, and this would let the policy treat these cranks accordingly)logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[193,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[193,logseq____&quot;^Flogseq____&quot;,196,536870921]],[logseq____&quot;^15logseq____&quot;,[193,logseq____&quot;^Xlogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[193,logseq____&quot;^Vlogseq____&quot;,181,536870921]],[logseq____&quot;^15logseq____&quot;,[193,logseq____&quot;^Ulogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[193,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-ffdd-4138-9f65-e8c957eef86alogseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[194,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;~```js\\nfunction makeComputronCounterPolicy(limit) {\\n    let total = 0;\\n    const policy = harden({\\n      vatCreated() {\\n        total += 100000; // pretend vat creation takes 100k computrons\\n        return (total logseq____&lt; limit);\\n      },\\n      crankComplete(details) {\\n        const { computrons } = details;\\n        total += computrons;\\n        return (total logseq____&lt; limit);\\n      },\\n      crankFailed() {\\n        total += 1000000; // who knows, 1M is as good as anything\\n        return (total logseq____&lt; limit);\\n      },\\n      emptyCrank() {\\n        return true;\\n      }\\n  });\\n}\\n```logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[194,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[194,logseq____&quot;^Flogseq____&quot;,156,536870921]],[logseq____&quot;^15logseq____&quot;,[194,logseq____&quot;^Xlogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[194,logseq____&quot;^Vlogseq____&quot;,155,536870921]],[logseq____&quot;^15logseq____&quot;,[194,logseq____&quot;^Ulogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[194,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-98ad-4a30-8328-324c9fe336calogseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[195,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;~```js\\nfunction makeWallclockPolicy(seconds) {\\nlet timeout = Date.now() + 1000*seconds;\\nconst policy = harden({\\n  vatCreated: () =logseq____&gt; Date.now() logseq____&lt; timeout,\\n  crankComplete: () =logseq____&gt; Date.now() logseq____&lt; timeout,\\n  crankFailed: () =logseq____&gt; Date.now() logseq____&lt; timeout,\\n  emptyCrank: () =logseq____&gt; Date.now() logseq____&lt; timeout,\\n});\\n}\\n```logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[195,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[195,logseq____&quot;^Flogseq____&quot;,177,536870921]],[logseq____&quot;^15logseq____&quot;,[195,logseq____&quot;^Xlogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[195,logseq____&quot;^Vlogseq____&quot;,153,536870921]],[logseq____&quot;^15logseq____&quot;,[195,logseq____&quot;^Ulogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[195,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-1f46-4760-accb-ab5103ad30c7logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[196,logseq____&quot;^Qlogseq____&quot;,logseq____&quot;~`crankComplete`: the aggregate size of the delivery/notification argumentslogseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[196,logseq____&quot;^Ologseq____&quot;,logseq____&quot;^16logseq____&quot;,536870921]],[logseq____&quot;^15logseq____&quot;,[196,logseq____&quot;^Flogseq____&quot;,190,536870921]],[logseq____&quot;^15logseq____&quot;,[196,logseq____&quot;^Xlogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[196,logseq____&quot;^Vlogseq____&quot;,181,536870921]],[logseq____&quot;^15logseq____&quot;,[196,logseq____&quot;^Ulogseq____&quot;,146,536870921]],[logseq____&quot;^15logseq____&quot;,[196,logseq____&quot;^;logseq____&quot;,logseq____&quot;~u66d81271-2539-4aeb-a3d5-8ccb016f51edlogseq____&quot;,536870921]]]]]]"</script>
 <script>window.logseq_state="{:ui/theme \"light\", :ui/radix-color :blue, :config {\"local\" {:shortcuts {}, :default-templates {:journals \"\"}, :query/views {:pprint (fn [r] [:pre.code (pprint r)])}, :macros {}, :shortcut/doc-mode-enter-for-new-block? false, :favorites [], :ui/show-empty-bullets? false, :file/name-format :triple-lowbar, :preferred-workflow :now, :publishing/all-pages-public? true, :ref/default-open-blocks-level 2, :feature/enable-block-timestamps? false, :start-of-week 6, :ref/linked-references-collapsed-threshold 50, :outliner/block-title-collapse-enabled? false, :commands [], :ui/show-full-blocks? true, :meta/version 1, :hidden [], :default-queries {:journals [{:title \"🔨 NOW\", :query [:find (pull ?h [*]) :in $ ?start ?today :where [?h :block/marker ?marker] [(contains? #{\"NOW\" \"DOING\"} ?marker)] [?h :block/page ?p] [?p :block/journal? true] [?p :block/journal-day ?d] [(>= ?d ?start)] [(<= ?d ?today)]], :inputs [:14d :today], :result-transform (fn [result] (sort-by (fn [h] (get h :block/priority \"Z\")) result)), :group-by-page? false, :collapsed? false} {:title \"📅 NEXT\", :query [:find (pull ?h [*]) :in $ ?start ?next :where [?h :block/marker ?marker] [(contains? #{\"NOW\" \"LATER\" \"TODO\"} ?marker)] [?h :block/page ?p] [?p :block/journal? true] [?p :block/journal-day ?d] [(> ?d ?start)] [(< ?d ?next)]], :inputs [:today :7d-after], :group-by-page? false, :collapsed? false}]}, :ui/auto-expand-block-refs? true, :ui/enable-tooltip? true, :query/result-transforms {:sort-by-priority (fn [result] (sort-by (fn [h] (get h :block/priority \"Z\")) result))}, :property-pages/enabled? true, :block/content-max-length 10000, :ui/show-command-doc? true, :feature/enable-search-remove-accents? true}}}"</script>
 <script type="text/javascript">// Single Page Apps for GitHub Pages
      // https://github.com/rafgraph/spa-github-pages
      // Copyright (c) 2016 Rafael Pedicini, licensed under the MIT License
      // ----------------------------------------------------------------------
      // This script checks to see if a redirect is present in the query string
      // and converts it back into the correct url and adds it to the
      // browser's history using window.history.replaceState(...),
      // which won't cause the browser to attempt to load the new url.
      // When the single page app is loaded further down in this file,
      // the correct url will be waiting in the browser's history for
      // the single page app to route accordingly.
      (function(l) {
        if (l.search) {
          var q = {};
          l.search.slice(1).split('&').forEach(function(v) {
            var a = v.split('=');
            q[a[0]] = a.slice(1).join('=').replace(/~and~/g, '&');
          });
          if (q.p !== undefined) {
            window.history.replaceState(null, null,
              l.pathname.slice(0, -1) + (q.p || '') +
              (q.q ? ('?' + q.q) : '') +
              l.hash
            );
          }
        }
      }(window.location))</script>
 <script src="static/js/react.production.min.js"></script>
 <script src="static/js/react-dom.production.min.js"></script>
 <script src="static/js/ui.js"></script>
 <script src="static/js/main.js"></script>
 <script src="static/js/interact.min.js"></script>
 <script src="static/js/highlight.min.js"></script>
 <script src="static/js/katex.min.js"></script>
 <script src="static/js/html2canvas.min.js"></script>
 <script src="static/js/code-editor.js"></script>
 <script src="static/js/custom.js"></script>
</body>
